!
function(d) {
    function e() {
        m(),
        t()
    }
    function t() {
        d.sub("user.synced",
        function() {
            d.user._isReady && (T(d.user._ddp_ids._m_ids.length + d.user._ddp_ids._f_ids.length), A())
        }),
        d.sub("user.ddpSynced",
        function() {
            d.user._isReady && (T(d.user._ddp_ids._m_ids.length + d.user._ddp_ids._f_ids.length), A(), u(1) && p(1), u(2) && p(2))
        }),
        d.subOnce("user.all_ready",
        function() {
            $("#ddp_startBtn").children("span").text("开始对对碰"),
            d.btnLoading($("#ddp_resetBtn"), "hide"),
            T(d.user._ddp_ids._m_ids.length + d.user._ddp_ids._f_ids.length),
            p(),
            A(),
            U(),
            g()
        }),
        d.sub("key.enter.down",
        function() {
            "ddp" == d.getState() && $("#ddp_startBtn").trigger("click")
        })
    }
    function a() {
        if (!d.user._ddp_ids._f_ids.length && !d.user._ddp_ids._m_ids.length) return d.showMsg("参与对对碰的女/男嘉宾不足，赶紧上墙来参加吧"),
        void 0;
        if ("yes" == $("#ddp_startBtn").attr("data-disabled")) return d.showMsg("正在配对保存中..."),
        void 0;
        var e = r();
        if ( - 1 == e) return d.showMsg("配对区位置已满，请先清空"),
        !1;
        if ($("#ddp_startBtn").attr("data-disabled", "yes"), gender = e, I = "matching", 0 == e) {
            var t = i(1, 1),
            a = i(2, 2);
            if (!t || !a) return l(),
            o(),
            !1
        } else i(e, gender);
        $("#ddp_startBtn").children("span").text("停止")
    }
    function s(d) {
        return 1 == d ? (u(1) && (O = {
            id: 0,
            gender: 0
        }), O) : 2 == d ? (u(2) && (S = {
            id: 0,
            gender: 0
        }), S) : void 0
    }
    function r() {
        return u() ? 0 : u(1) ? 1 : u(2) ? 2 : -1
    }
    function i(e, t) {
        var a, s, r;
        if (1 == e) a = $("#ddp_userAvatar"),
        s = $("#ddp_userName");
        else {
            if (2 != e) return ! 1;
            a = $("#ddp_toUserAvatar"),
            s = $("#ddp_toUserName")
        }
        if (1 == t ? r = d.user._ddp_ids._m_ids: 2 == t ? r = d.user._ddp_ids._f_ids: d.throwErr("in func _slideUser: gender param is wrong"), !r.length) return l(e),
        o(e),
        d.showMsg("参与对对碰的嘉宾不足，赶紧上墙来参加吧"),
        !1;
        l(e);
        var i = setInterval(function() {
            var d = c(r);
            a.attr("src", d.avatar),
            s.html(d.name),
            _(e, d)
        },
        45);
        return n(e, i),
        !0
    }
    function n(d, e) {
        1 == d ? y = e: 2 == d && (k = e)
    }
    function _(d, e) {
        1 == d ? O = e: 2 == d && (S = e)
    }
    function c(e) {
        if (!e.length) return d.showMsg("参与对对碰的女/男嘉宾不足，赶紧上墙来参加吧"),
        d.throwErr("_getDisplayUser !users.length"),
        void 0;
        var t = d.rand(0, e.length - 1),
        a = e[t];
        return d.user.info(a)
    }
    function l(d) {
        d ? 1 == d ? (clearInterval(y), y = null) : 2 == d && (clearInterval(k), k = null) : (clearInterval(y), y = null, clearInterval(k), k = null)
    }
    function u(d) {
        return 1 == d ? $("#ddp_userAvatar").data("default_src") == $("#ddp_userAvatar").attr("src") : 2 == d ? $("#ddp_toUserAvatar").data("default_src") == $("#ddp_toUserAvatar").attr("src") : u(1) && u(2)
    }
    function p(e) {
        if (1 == e) $("#ddp_userAvatar").attr("src", $("#ddp_userAvatar").data("default_src")),
        $("#ddp_userName").html("♂共" + d.user._ddp_ids._m_ids.length + "位"),
        s(1);
        else {
            if (2 != e) return p(1),
            p(2),
            void 0;
            $("#ddp_toUserAvatar").attr("src", $("#ddp_toUserAvatar").data("default_src")),
            $("#ddp_toUserName").html("♀共" + d.user._ddp_ids._f_ids.length + "位"),
            s(2)
        }
    }
    function o(d) {
        p(d),
        $("#ddp_startBtn").attr("data-disabled", "no").children("span").text("开始对对碰"),
        $("#ddp_bubble1, #ddp_bubble2, #ddp_bubble3").hide()
    }
    function h() {
        l();
        var e, t;
        e = s(1),
        t = s(2),
        e.id && t.id ? (I = "pos_all_matched", f(e, t), I = "saving", $("#ddp_startBtn").children("span").text("配对保存中..."), d.user.ddpSave(e.id, t.id,
        function(e, t) {
            e ? (d.showMsg(e), o()) : ($('.ddp_matchedUser[data-id="' + t.user_id + '"]').closest("li").attr("data-id", t.id), w(), x(d.user._ddped_ids.length), A(t), T(d.user._ddp_ids._m_ids.length + d.user._ddp_ids._f_ids.length)),
            I = "keeping",
            $("#ddp_startBtn").children("span").text("开始对对碰")
        })) : (I = e.id ? "pos1_matched": "pos2_matched", $("#ddp_startBtn").attr("data-disabled", "no").children("span").text("开始对对碰"))
    }
    function f(e, t) {
        return e && t ? (T(d.user._ddp_ids._m_ids.length + d.user._ddp_ids._f_ids.length), $("#ddp_bubble1").fadeIn(200), setTimeout(function() {
            $("#ddp_bubble2").fadeIn(300)
        },
        250), setTimeout(function() {
            $("#ddp_bubble3").fadeIn(300)
        },
        300), void 0) : !1
    }
    function m() {
        b(),
        v()
    }
    function v() {
        $(".ddp_matchedUser, .ddp_matchedToUser").live("mouseenter",
        function() {
            $(this).find(".delMatchedUserBtn").show()
        }).live("mouseleave",
        function() {
            $(this).find(".delMatchedUserBtn").hide()
        }),
        $(".ddp_matchedUserOne").live("mouseenter",
        function() {
            $(this).find(".delMatchedAllBtn").show()
        }).live("mouseleave",
        function() {
            $(this).find(".delMatchedAllBtn").hide()
        }),
        $(".delMatchedUserBtn, .delMatchedAllBtn").live("click",
        function() {
            if (!u() && (u(1) || u(2))) return d.showMsg("对对碰区域还有未完成的配对，暂不能进行删除操作"),
            !1;
            if (!confirm("确定要拆散这对有缘人？")) return ! 1;
            var e, t = $(this),
            a = 0,
            s = 0,
            r = 0;
            t.hasClass("delMatchedAllBtn") ? (a = t.closest("li").find(".ddp_matchedUser").attr("data-id"), s = t.closest("li").find(".ddp_matchedToUser").attr("data-id"), e = {
                id: a,
                to_id: s
            }) : t.closest(".ddp_matchedUser").length ? (a = t.closest(".ddp_matchedUser").attr("data-id"), s = t.closest(".ddp_matchedUser").siblings(".ddp_matchedToUser").attr("data-id"), r = 2, e = {
                id: a,
                to_id: 0
            }) : (s = t.closest(".ddp_matchedToUser").attr("data-id"), a = t.closest(".ddp_matchedToUser").siblings(".ddp_matchedUser").attr("data-id"), r = 1, e = {
                id: 0,
                to_id: s
            }),
            d.user.ddpDelete(e.id, e.to_id,
            function(e, t) {
                if (e) return d.showMsg(e);
                if (A(t), T(d.user._ddp_ids._m_ids.length + d.user._ddp_ids._f_ids.length), r) {
                    o();
                    var i = 1 == r ? a: s,
                    n = d.user.info(i);
                    1 == r ? ($("#ddp_userAvatar").attr("src", n.avatar), $("#ddp_userName").html(n.name), _(1, n), I = "pos1_matched") : ($("#ddp_toUserAvatar").attr("src", n.avatar), $("#ddp_toUserName").html(n.name), _(2, n), I = "pos2_matched");
                    var c = 1 == r ? "为他求缘分": "为她求缘分";
                    $("#ddp_startBtn").children("span").text(c)
                }
            })
        })
    }
    function g() {
        $("#ddp_resetBtn").click(function() {
            return "yes" == $(this).attr("data-disabled") ? (d.showMsg("正在重置配对信息..."), void 0) : (d.btnLoading($(this), "show"), d.user.ddpReset(function(e) {
                return d.btnLoading($("#ddp_resetBtn"), "hide"),
                e ? d.showMsg(e) : (T(d.user._ddp_ids._m_ids.length + d.user._ddp_ids._f_ids.length), A(), o(), void 0)
            }), void 0)
        })
    }
    function U() {
        $("#ddp_startBtn").click(function() {
            "free" == I || "pos1_matched" == I || "pos2_matched" == I || "keeping" == I ? ("keeping" == I && (o(), I = "free"), a()) : "matching" == I ? h() : d.showMsg("稍等，正在对对碰...")
        })
    }
    function b() {
        $(".btnDdp").click(function() {
            return d.getConf("ddpPlug") ? (B(), void 0) : (alert("对不起，您还没有开通对对碰功能，请咨询客服"), void 0)
        }),
        d.sub("key.68.down",
        function() {
            $(".btnDdp").trigger("click")
        })
    }
    function B() {
        $("#ddp_layer:visible").length ? d.setState("message") : d.setState("ddp")
    }
    function w() {
        var d = $("#ddp_matchedUserBox li"),
        e = d.length;
        $.each(d,
        function(d) {
            $(this).find(".ddp_viewOrder").text(e - d)
        })
    }
    function A(e) {
        if (e) {
            if (e.id > 0 && e.user_id <= 0 && e.to_user_id <= 0) return $('.ddp_matchedUserOne[data-id="' + e.id + '"]').fadeOut("fast",
            function() {
                $(this).remove(),
                w(),
                x(d.user._ddped_ids.length),
                o()
            }),
            void 0;
            var t;
            if (e.user_id > 0 && (t = $('.ddp_matchedUser[data-id="' + e.user_id + '"]')), t && t.length || !(e.to_user_id > 0) || (t = $('.ddp_matchedToUser[data-id="' + e.to_user_id + '"]')), t && t.length) {
                var a = t.closest("li");
                e.user_id > 0 ? (a.find(".ddp_matchedUser").attr("data-id", e.user_id), a.find(".ddp_matchedUserAvatar").attr("src", e.avatar), a.find(".ddp_matchedUserName").html(e.name)) : (a.find(".ddp_matchedUser").attr("data-id", 0), a.find(".ddp_matchedUserAvatar").attr("src", $("#ddp_userAvatar").attr("data-default_src")), a.find(".ddp_matchedUserName").html("……")),
                e.to_user_id > 0 ? (a.find(".ddp_matchedToUser").attr("data-id", e.to_user_id), a.find(".ddp_matchedToUserAvatar").attr("src", e.to_avatar), a.find(".ddp_matchedToUserName").html(e.to_name)) : (a.find(".ddp_matchedToUser").attr("data-id", 0), a.find(".ddp_matchedToUserAvatar").attr("src", $("#ddp_toUserAvatar").attr("data-default_src")), a.find(".ddp_matchedToUserName").html("……")),
                a.attr("data-id", e.id)
            } else {
                var s = M(e);
                $("#ddp_matchedUserBox").prepend(s),
                $("#ddp_matchedUserBox").parent().scrollTop(0)
            }
        } else {
            for (var s = "",
            r = !1,
            i = d.user._ddped_ids.length - 1; i >= 0; i--) {
                var n = d.user._ddped_ids[i];
                $('#ddp_matchedUserBox li[data-id="' + n.id + '"]').length || (r = !0),
                s += M(d.user._ddped_ids[i])
            } (r || !d.user._ddped_ids.length) && $("#ddp_matchedUserBox").html(s)
        }
        w(),
        x(d.user._ddped_ids.length)
    }
    function M(d) {
        var e = '      <li class="clearfix ddp_matchedUserOne" data-id="' + d.id + '">        <span class="num-p num-p-pair left ddp_viewOrder"></span>        <div class="wrap-pair-per">          <span class="icon-heart2"></span>          <div class="pair-sel ddp_matchedUser" data-id="' + d.user_id + '">            <a><img width=50 height=50 class="ddp_matchedUserAvatar" src="' + d.avatar + '" alt=""></a>            <a class="pair-name ddp_matchedUserName">' + d.name + '</a>            <a href="javascript:void(0);" class="del2 delMatchedUserBtn">×</a>          </div>          <div class="pair-sel ddp_matchedToUser" data-id="' + d.to_user_id + '">            <a><img width=50 height=50 class="ddp_matchedToUserAvatar" src="' + d.to_avatar + '" alt=""></a>            <a class="pair-name ddp_matchedToUserName">' + d.to_name + '</a>            <a href="javascript:void(0);" class="del2 delMatchedUserBtn">×</a>          </div>        </div>        <a href="javascript:void(0);" class="del del3 delMatchedAllBtn">×</a>      </li>';
        return e
    }
    function T(d) {
        isNaN(d) || $("#ddp_userCount").text(d)
    }
    function x(d) {
        isNaN(d) || $("#ddp_matchedGroupNum").text(d)
    }
    if (!d.ddp) {
        var N = d.ddp = {};
        N.off = function() {
            d.user._isReady && (d.user.pullStop(), d.user.ddpPullStop()),
            $("#ddp_layer").fadeOut("fast")
        },
        N.on = function() {
            d.user._isReady && (d.user.pull(), d.user.ddpPull()),
            $("#ddp_layer").fadeIn("fast")
        };
        var y, k, I = "free",
        O = {
            id: 0,
            gender: 0
        },
        S = {
            id: 0,
            gender: 0
        };
        $(function() {
            e()
        })
    }
} (wxscreen);