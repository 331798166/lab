!
function(t) {
    if (!t.messageDetail) {
        var e = t.messageDetail = {};
        e.init = function() {
            this._box = $(".messageDetailBox"),
            this._listBox = $(".messageDetailList"),
            this._currentId = 0,
            this._scrollWidth = 0,
            this._scrollState = "stoped",
            this._scrollSpeed = 400;
            var t = '      <div class="mayer-box hidden imageDetailLayer"></div>      <div style="display:none;" class="imgdetail imageDetailbox">        <div class="imgbox">          <a href="javascript:void(0);" class="flbtn-close imageDetailCloseBtn"></a>        </div>      </div>';
            $("#wrap").append(t),
            this.bindEvent(),
            this.subEvent()
        },
        e.renderOne = function(e) {
            var a = "";
            if (!e) return a;
            var s, i, r = !!e.photo_small;
            if (r) s = "",
            i = '        <div class="artZoomBox" style="min-width: 230px;">          <div class="tool" style="z-index: 1;min-width: 230px;">            <a class="viewImg" href="javascript:;" title="查看原图">查看原图</a>            <a class="imgLeft" href="javascript:;" title="向左转">向左转</a>            <a class="imgRight" href="javascript:;" title="向右转">向右转</a>          </div>          <a class="">            <img class="messageDetailImage maxImg" src="' + e.photo_ori + '" style="cursor:pointer;">          </a>        </div>',
            t.loadImage(e.photo_ori);
            else {
                var l = this.fontSize(e.content) + "px";
                i = "",
                s = '<p class="detail-cont messageDetailContent" style="font-size:' + l + ';">' + e.content + "</p>"
            }
            return a += '      <div class="detail-bar" style="cursor: default;" data-id="' + e.id + '">        <div class="detail-top clearfix">          <a href="javascript:;" class="head left messageOneAvatar"><img src="' + e.avatar + '" width="100" height="100" alt=""></a>          <p class="detail-info">            <a href="javascript:;" class="user-name-detail messageOneName">' + e.username + ':</a>            <span class="messageDetailIntroLabel">来自微信</span>          </p>        </div>        ' + s + '        <div class="imgb-show">          ' + i + "        </div>      </div>"
        },
        e.scrollCheck = function() {
            return "running" == this._scrollState ? !1 : this._currentId ? !0 : !1
        },
        e.renderScroll = function(t, e) {
            if (!t || !t.length) return ! 1;
            if (t[0].id == this._currentId) return ! 1;
            var a = Math.abs(this._listBox.attr("data-to") || 0) / this._scrollWidth,
            s = this._listBox.children(":eq(" + a + ")");
            if (!s || !s.length) return ! 1;
            for (var i = "",
            r = 0; r < t.length; r++) i += this.renderOne(t[r]);
            return i ? (s.nextAll().remove(), s.prevAll().remove(), this.scrollFn(this._listBox, 0, 0), "prev" == e ? (s.before(i), this.scrollFn(this._listBox, -t.length * this._scrollWidth, 0), this.scrollFn(this._listBox, 0)) : (s.after(i), this.scrollFn(this._listBox, -t.length * this._scrollWidth)), this) : !1
        },
        e.scrollPrev = function() {
            if (!this.scrollCheck()) return ! 1;
            var e = t.message.prev(1);
            if (e) return t.message.setScrollType("prev"),
            this.renderScroll([e.data], "prev")
        },
        e.scrollNext = function() {
            if (!this.scrollCheck()) return ! 1;
            var e = t.message.next(1);
            if (e) return t.message.setScrollType("next"),
            this.renderScroll([e.data], "next")
        },
        e.scrollNewest = function() {
            if (!this.scrollCheck()) return ! 1;
            var e = t.message.newest(1);
            if (e) return t.message.setScrollType("newest"),
            this.renderScroll([e.data], "next")
        },
        e.scrollOldest = function() {
            if (!this.scrollCheck()) return ! 1;
            var e = t.message.oldest(1);
            if (e) return t.message.setScrollType("oldest"),
            this.renderScroll([e.data], "prev")
        },
        e.scrollFn = function(e, a, s) {
            var i = this,
            r = "animate";
            t.message._transitions && (r = "translate"),
            t.message.pause(),
            e.attr("data-to", a),
            this._scrollState = "running",
            i[r](e, a, s)
        },
        e.translate = function(t, e, a) {
            a = "undefined" == typeof a ? this._scrollSpeed: a;
            var s = this;
            return 0 == a ? t.css({
                x: e + "px"
            }) : t.transition({
                x: e + "px"
            },
            a,
            function() {
                s.afterScrollEnd()
            }),
            this
        },
        e.animate = function(t, e, a) {
            if (0 === a) return t.css("left", e + "px"),
            this;
            var s = this;
            return a = "undefined" == typeof a ? this._scrollSpeed: a,
            t.animate({
                left: e
            },
            a,
            function() {
                s.afterScrollEnd()
            }),
            this
        },
        e.afterScrollEnd = function() {
            this._scrollState = "stoped",
            t.pub("messageDetail.afterScrollEnd");
            var e = this._listBox.attr("data-to") || 0,
            a = Math.abs(e) / this._scrollWidth;
            this._currentId = this._listBox.children(":eq(" + a + ")").attr("data-id"),
            t.message.resume()
        },
        e.fontSize = function(e) {
            if (!e) return 15; - 1 != e.indexOf("<img") && (e = e.replace(/\<img.+?\>/g, "11"));
            var a = 60,
            s = 292400;
            fontNum = t.fontNum(e);
            var i = Math.sqrt(s / fontNum) / 1.6;
            return i > a ? a: i
        },
        e.show = function(e) {
            var a = t.progress.state;
            t.message.pause(),
            t.setState("messageDetail"),
            t.message.pull();
            var s = this.renderOne(e);
            this._listBox.html(s),
            this.scrollFn(this._listBox, 0, 0);
            var i = this;
            this._box.fadeIn("fast",
            function() {
                i._scrollWidth = t._width(i._listBox.children(":eq(0)")),
                i.afterScrollEnd(),
                "running" != a ? t.message.pause() : t.progress.restart()
            })
        },
        e.hide = function() {
            var e = t.progress.state;
            t.setState("message"),
            "running" != e ? t.message.pause() : t.progress.restart()
        },
        e.autoScale = function(e) {
            if (!e) return ! 1;
            var a = e.attr("src"),
            s = e.attr("data-width"),
            i = e.attr("data-height"),
            r = e.attr("data-rotate") || 0,
            l = 0 == Math.abs(r) / 90 % 2 ? 0 : 1,
            o = parseInt($.css(e[0], "max-width")) || 800,
            n = parseInt($.css(e[0], "max-height")) || 340,
            c = function() {
                if (e.attr("data-width", s), e.attr("data-height", i), !(o > s && n > i)) {
                    var t = s,
                    a = i,
                    r = t / a,
                    c = 1;
                    t > o && (t = o, a = t / r),
                    a > n && (a = n, t = a * r),
                    1 == l && (c = o / a, c * t > n && (c = n / t)),
                    e.css({
                        width: t + "px",
                        height: a + "px",
                        scale: c
                    }).removeClass("maxImg")
                }
            };
            return s && i ? (c(), void 0) : (t.loadImage(a,
            function(t, e, a) {
                return t ? !1 : (s = a.width, i = a.height, c(), void 0)
            }), void 0)
        },
        e.bindEvent = function() {
            var e = this;
            $(".scrollBox").delegate("li", "click",
            function() {
                var a = $(this).closest("li").attr("data-id");
                if (!a) return ! 1;
                var s = t.message.info(a);
                if (!s) {
                    var i = $(this).find(".msgImage"),
                    r = i.length ? i.attr("src") : "";
                    s = {
                        id: a,
                        username: $(this).find(".msgUserName").html().replace(/:$/, ""),
                        avatar: $(this).find(".msgAvatar").attr("src"),
                        photo_ori: r,
                        photo_small: r,
                        content: $(this).find(".displayContent").html()
                    }
                }
                e.show(s)
            }),
            $(".scrollBox").delegate("li", "mouseenter",
            function() {
                $(this).children(".messageDetailBtn").show()
            }),
            $(".scrollBox").delegate("li", "mouseleave",
            function() {
                $(this).children(".messageDetailBtn").hide()
            }),
            this._box.hover(function() {
                $(".messageDetailCloseBtn").show()
            },
            function() {
                $(".messageDetailCloseBtn").hide()
            }),
            $(".messageDetailCloseBtn").click(function() {
                e.hide()
            }),
            $(".messageDetailBox").delegate(".imgLeft", "click",
            function() {
                var t = $(this).closest(".artZoomBox").find(".messageDetailImage"),
                a = parseInt(t.attr("data-rotate")) || 0;
                360 == Math.abs(a) && (a = 0),
                a -= 90,
                t.attr("data-rotate", a),
                t.css({
                    rotate: a + "deg"
                }),
                e.autoScale(t)
            }),
            $(".messageDetailBox").delegate(".imgRight", "click",
            function() {
                var t = $(this).closest(".artZoomBox").find(".messageDetailImage"),
                a = parseInt(t.attr("data-rotate")) || 0;
                360 == Math.abs(a) && (a = 0),
                a += 90,
                t.attr("data-rotate", a),
                t.css({
                    rotate: a + "deg"
                }),
                e.autoScale(t)
            }),
            $(".messageDetailBox").delegate(".viewImg", "click",
            function() {
                t.message.pause();
                var e, a, s, i = $(this).closest(".artZoomBox").find(".messageDetailImage"),
                r = i.attr("src"),
                l = i.attr("data-rotate") || 0,
                o = 0 == Math.abs(l) / 90 % 2 ? 0 : 1,
                n = 1,
                c = $(window).width(),
                h = $(window).height();
                e = i.attr("data-width"),
                a = i.attr("data-height");
                var d = function() {
                    s = e / a,
                    e > c && (e = c, a = e / s),
                    a > h && (a = h, e = a * s),
                    1 == o && (n = c / a, n * e > h && (n = h / e));
                    var t = (h - a) / 2,
                    i = '<img class="imageDetailElem" src="' + r + '" style="width:' + e + "px;height:" + a + "px;margin-top:" + t + 'px" />';
                    $(".imageDetailbox .imgbox").append(i),
                    $(".imageDetailLayer").show(),
                    $(".imageDetailbox").show(),
                    $(".imageDetailbox .imgbox img").css({
                        rotate: l + "deg"
                    })
                };
                return e && a ? (d(), void 0) : (t.loadImage(r,
                function(t, s, r) {
                    return t ? !1 : (e = r.width, a = r.height, i.attr("data-width", e), i.attr("data-height", a), d(), void 0)
                }), void 0)
            }),
            $(".messageDetailBox").delegate(".messageDetailImage", "click",
            function() {
                $(this).closest(".artZoomBox").find(".viewImg").trigger("click")
            }),
            $(".messageDetailBox").delegate(".artZoomBox", "mouseenter",
            function() {
                $(this).addClass("js_hover")
            }),
            $(".messageDetailBox").delegate(".artZoomBox", "mouseleave",
            function() {
                $(this).removeClass("js_hover")
            }),
            $(".imageDetailCloseBtn").click(function() {
                $(".imageDetailLayer").hide(),
                $(".imageDetailbox").hide(),
                $(".imageDetailbox .imgbox img:last").remove()
            }),
            $(".imageDetailElem").live("click",
            function() {
                $(".imageDetailCloseBtn").trigger("click")
            }),
            $(".imageDetailbox .imgbox").hover(function() {
                $(".imageDetailCloseBtn").show()
            },
            function() {
                $(".imageDetailCloseBtn").hide()
            })
        },
        e.off = function() {
            this._currentId = null,
            "messageDetail" == t.getState() && (t.message.pause(), this._box.fadeOut("fast"))
        },
        e.subEvent = function() {
            var e = this;
            t.sub("control.btn.btnNewest.clicked",
            function() {
                "messageDetail" == t.getState() && e.scrollNewest()
            }),
            t.sub("control.btn.btnOldest.clicked",
            function() {
                "messageDetail" == t.getState() && e.scrollOldest()
            }),
            t.sub("control.btn.btnNext.clicked, key.right.down",
            function() {
                "messageDetail" == t.getState() && e.scrollNext()
            }),
            t.sub("control.btn.btnPrev.clicked, key.left.down",
            function() {
                "messageDetail" == t.getState() && e.scrollPrev()
            }),
            t.sub("event.progress.compelete",
            function() {
                "messageDetail" == t.getState() && e.scrollNext()
            })
        }
    }
} (wxscreen);