!
function(t) {
    function e(t, e) {
        return t && t.length ? parseInt($.css(t[0], e)) || 0 : 0
    }
    function i(t) {
        return t && t.length ? t[0].offsetWidth + e(t, "marginLeft") + e(t, "marginRight") : 0
    }
    function r(t) {
        return t && t.length ? t[0].offsetHeight + e(t, "marginTop") + e(t, "marginBottom") : 0
    }
    
    if (!t.wxscreen) {
        var n = t.wxscreen = {
            _initialized: !1,
            _config: {},
            _state: null
        };

        n.DEBUG = !0;
        var s = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",
            o = 0,
            l = {},
            a = ["message", "messageDetail", "lottery", "ddp", "vote"];

        n.init = function(t) {
            return this._config.isAdmin = t.isAdmin || 0,
            this._config.template = t.template || "",
            this._config.visibleNum = t.visibleNum || 0,
            this._config.autoTime = t.autoTime || 0,
            this._config.stepTime = t.stepTime || 0,
            this._config.domain = t.domain || "",
            this._config.siteUrl = t.siteUrl || "",
            this._config.companyId = t.companyId || 0,
            this._config.timerColorMap = t.timerColorMap || "",
            this._config.lotteryPlug = t.lotteryPlug || 0,
            this._config.ddpPlug = t.ddpPlug || 0,
            this._config.votePlug = t.votePlug || 0,
            this._config.isDemo = t.isDemo || 0,
            this._config.maxMessageNum = t.maxMessageNum || 300,
            this._config.isCycleScroll = 1 == t.isCycleScroll ? 1 : 0,
            this._config.isV6 = t.isV6,
            this._config.messageVisibleTime = t.messageVisibleTime || null,
            this._config.lotteryVisibleTime = t.lotteryVisibleTime || null,
            this._config.ddpVisibleTime = t.ddpVisibleTime || null,
            this._config.template && this._config.visibleNum && this._config.autoTime && this._config.stepTime && this._config.domain && this._config.siteUrl && this._config.companyId && this._config.timerColorMap || this.throwErr("in wxscreen.init config params is empty"),
            this._initialized = !0,
            this
        },
        n.getConf = function(t) {
            return this._initialized || this.throwErr("in func wxscreen.getConf wxscreen is not _initialized"),
            "string" == typeof t && t || this.throwErr("in func wxscreen.getConf name is empty or not string type"),
            "undefined" != typeof this._config[t] ? this._config[t] : (this.throwErr("in func wxscreen.getConf config[" + t + "] is not exists"), void 0)
        },
        n.isAdmin = function() {
            return this._initialized || this.throwErr("in func wxscreen.isAdmin wxscreen is not _initialized"),
            this._config.isAdmin
        },
        n.url = function(t) {

            return "http://192.168.222.177:31000/wechatscreen/defined/" + t + '.json';

            this._initialized || this.throwErr("in func wxscreen.url wxscreen is not _initialized");
            var t = this._config.siteUrl + "/" + this._config.domain + "/" + t,
            e = (new Date).getTime();
            return t.indexOf("?") > -1 ? t + "&r=" + e: t + "?r=" + e
        },
        n.getState = function() {
            return this._state
        },
        n.setState = function(t) {
            return - 1 != this.inArray(t, a, !0) ? (this._state && this[this._state] && this[this._state].off && this[this._state].off(), this._state = t, this[this._state] && this[this._state].on && this[this._state].on(), "ddp" == this.getState() || "lottery" == this.getState() ? $(".scrollBox").css({
                visibility: "hidden"
            }) : $(".scrollBox").css({
                visibility: "visible"
            }), !0) : !1
        },
        n.fontNum = function(t) {
            if ("undefined" == typeof t) return 0;
            var e = t.match(/[^\x00-\x80]/g);
            return Math.ceil((t.length + (e ? e.length: 0)) / 2)
        },
        n.loop = function() {},
        n.showMsg = function(t) {
            alert(t)
        },
        n.randomStr = function(t) {
            if (isNaN(t)) return "";
            for (var e = "",
            i = 0; t > i; i++) {
                var r = this.rand(0, 61);
                e += s.charAt(r)
            }
            return e
        },
        n.trim = function(t, e) {
            return e ? this.rtrim(this.ltrim(t, e), e) : t.replace(/(^\s*)|(\s*$)/g, "")
        },
        n.ltrim = function(t, e) {
            if (t = String(t), !e) return t.replace(/(^\s*)/g, "");
            e = String(e);
            var i = t.charAt(0);
            return - 1 != e.indexOf(i) ? (t = t.substr(1), 0 == t.length ? t: this.ltrim(t, e)) : t
        },
        n.rtrim = function(t, e) {
            if (t = String(t), !e) return t.replace(/(\s*$)/g, "");
            e = String(e);
            var i = t.charAt(t.length - 1);
            return - 1 != e.indexOf(i) ? (t = t.substr(0, t.length - 1), 0 == t.length ? t: this.rtrim(t, e)) : t
        },
        n.rand = function(t, e) {
            return Math.floor(Math.random() * (e - t + 1)) + t
        },
        n.isNull = function(t) {
            return t || "object" != typeof t ? !1 : !0
        },
        n.inArray = function(t, e, i) {
            if (e instanceof Array || this.throwErr("function wxs.inArray param two is not a Array type", "TypeError"), i && Array.prototype.indexOf) return e.indexOf(t);
            for (var r = 0; r < e.length; r++) {
                if (i && t === e[r]) return r;
                if (t == e[r]) return r
            }
            return - 1
        },
        n.log = function() {
            return arguments.length ? (window.console && console.log && console.log.apply && (console.log("========= log start ========="), console.log.apply(console, Array.prototype.slice.call(arguments, 0, arguments.length)), console.log(" ")), void 0) : !1
        },
        n.throwErr = function(t, e) { ("string" != typeof t || e && "string" != typeof e) && (this.log("function wxs.throwErr params", t, e), this.throwErr("wxs.throwErr function error: params TypeError", "TypeError"));
            try {
                switch (e) {
                case "SyntaxError":
                    throw new SyntaxError(t);
                case "TypeError":
                    throw new TypeError(t);
                case "URIError":
                    throw new URIError(t);
                case "ReferenceError":
                    throw new ReferenceError(t);
                case "RangeError":
                    throw new RangeError(t);
                case "EvalError":
                    throw new EvalError(t);
                default:
                    throw new Error(t)
                }
            } catch(i) {
                throw window.console && console.trace && console.trace(),
                i
            }
        },
        n.preLoadAvatar = function(t) {
            this.loadImage(t)
        },
        n.loadImage = function(t, e, i) {
            if (t) {
                if ("undefined" == typeof i && (i = document.createElement("img")), i.src = t, i.complete) return e && e(null, t, i),
                void 0;
                i.onload = function() {
                    i.onload = null,
                    e && e(null, t, i)
                },
                i.onerror = function() {
                    e && e("loadimage-error:" + t, null)
                }
            }
        },
        n.btnLoading = function(t, e) {
            "show" == e ? (t.attr("data-disabled", "yes"), t.children("span").hide().siblings("img").show()) : (t.attr("data-disabled", "no"), t.children("span").show().siblings("img").hide())
        },
        n.uniqueInsert = function(t, e, i) {
            return e instanceof Array || this.throwErr("wxscreen.uniqueInsert arr is not Array"),
            -1 != this.inArray(t, e) ? !1 : (i = i || "push", "push" == i ? (e.push(t), !0) : "unshift" == i ? (e.unshift(t), !0) : !1)
        },
        n.deleteByElem = function(t, e) {
            var i = this.inArray(t, e);
            return i >= 0 ? (e.splice(i, 1), !0) : !1
        },
        n.cid = function() {
            return++o
        },
        n.counter = function(e, i) {
            "string" == typeof e && e || t.throwErr("wxs.counter name is not a string type or empty", e);
            var r = typeof i;
            return "undefined" == r ? ("undefined" == typeof l[e] && (l[e] = 0), ++l[e]) : (l[e] = 0, !0)
        },
        n.parseVisibleTime = function(t) {
            var e = this.getConf(t + "VisibleTime");
            if (!e) return this.DEBUG && this.log("wxs.parseVisibleTime error: ", t + "VisibleTime"),
            !1;
            if (e.latest_hour > 0) {
                var i = new Date;
                return [i.getTime() - 1e3 * 3600 * e.latest_hour, Date.parse(this._generateDateStr("2099-01-01 00:00:00"))]
            }
            return e.start_time ? [Date.parse(this._generateDateStr(e.start_time)), Date.parse(this._generateDateStr(e.end_time))] : [0, Date.parse(this._generateDateStr("2099-01-01 00:00:00"))]
        },
        n._generateDateStr = function(t) {
            return t.replace(/\-/g, "/")
        },
        n.autoSizeTheme = function() {
            var t, e;
            if (e = $(".themeBox"), !e.length) return ! 1;
            if (t = $.trim(e.html()), !t) return ! 1;
            if (t.indexOf("<br>") > -1 || t.indexOf("<br/>") > -1 || t.indexOf("<br />") > -1) return ! 0;
            if (!this.getConf("isV6")) return ! 0;
            var i = this.fontNum(t);
            if (i > 14) return ! 0;
            var r = 338 / i;
            return r > 46 && (r = 46),
            e.css({
                "line-height": "86px",
                "font-size": r + "px"
            }),
            !0
        },
        n.autoCenterLogo = function() {
            var t = $(".logoScreenLeft"),
            e = t.attr("src");
            this.loadImage(e,
            function(e, i, r) {
                var n = r.width,
                s = r.height,
                o = s,
                l = n,
                a = 0,
                d = 0;
                o > 96 && (o = 96, l = 96 * (n / s)),
                l > 220 && (l = 220, o = 220 * (s / n)),
                220 > l && (a = (220 - l) / 2),
                96 > o && (d = (96 - o) / 2),
                t.css({
                    position: "relative",
                    width: l + "px",
                    height: o + "px",
                    left: a + "px",
                    top: d + "px"
                })
            })
        },
        n.initNetworkState = function() {
            var t = null,
            e = this;
            this.sub("network.disconnected",
            function() {
                e.getConf("isV6") && (t || (t = setInterval(function() {
                    $(".btnNetwork").show().toggleClass("btn-wifi-disable")
                },
                200)))
            }),
            this.sub("network.ok",
            function() {
                e.getConf("isV6") && t && (clearInterval(t), t = null, setTimeout(function() {
                    $(".btnNetwork").hide()
                },
                210))
            }),
            window.onbeforeunload = function() {
                wxscreen.subLock(!0)
            }
        },
        n.hashTrigger = function() {
            $(function() {
                var t = window.location.hash;
                switch (t) {
                case "#trigger_ddp":
                    $(".btnDdp").trigger("click");
                    break;
                case "#trigger_lottery":
                    $(".btnLottery").trigger("click");
                    break;
                case "#trigger_vote":
                    $(".btnVote").trigger("click")
                }
            })
        },
        n._css = function(t, i) {
            return e(t, i)
        },
        n._width = function(t) {
            return i(t)
        },
        n._height = function(t) {
            return r(t)
        }
    }
} (window),
function(t) {
    function e(t) {
        for (var e = {},
        i = 0; i < t.length; i++) e[t[i]] = null;
        return {
            channel: t,
            callback: [],
            data: e,
            fired: []
        }
    }
    function i(e) {
        return "string" != typeof e && t.throwErr("wxscreen.sub params error: channel is not a string type"),
        e = t.trim(t.trim(e), ","),
        e || t.throwErr("wxscreen.sub params error: channel is empty."),
        -1 != e.indexOf(",") && (e = e.replace(/\s+/g, "")),
        e
    }
    if (t.sub) return ! 1;
    var r = {},
    n = {},
    s = !1;
    t.pub = function(e, o) {
        if (e = i(e), s) return t.DEBUG && t.log("in g.pub eventBlocked"),
        !1;
        if ( - 1 != e.indexOf(",")) for (var l = e.split(","), a = 0; a < l.length; a++) t.pub(l[a], o);
        else {
            if (r[e]) for (var a = 0; a < r[e].length; a++) isNaN(r[e][a].times) ? r[e][a].callback(e, o) : (r[e][a].times-->0 && r[e][a].callback(e, o), r[e][a].times <= 0 && (r[e].splice(a, 1), a--));
            for (var d in n) if ( - 1 != t.inArray(e, n[d].channel) && (t.uniqueInsert(e, n[d].fired), n[d].data[e] = o, n[d].channel.length == n[d].fired.length)) {
                for (var u = 0; u < n[d].callback.length; u++) isNaN(n[d].callback[u].times) ? n[d].callback[u].callback(n[d].channel, n[d].data) : (n[d].callback[u].times-->0 && n[d].callback[u].callback(n[d].channel, n[d].data), n[d].callback[u].times <= 0 && (n[d].callback.splice(u, 1), u--));
                n[d].data = {},
                n[d].fired = []
            }
        }
        return ! 0
    },
    t.sub = function(s, o, l) {
        if (s = i(s), -1 != s.indexOf(" ")) {
            var a, d;
            a = s.replace(/\s+/g, " ").split(" ").sort(),
            d = a.join(","),
            n[d] || (n[d] = e(a)),
            n[d].callback.push({
                callback: o,
                times: l
            })
        } else if ( - 1 != s.indexOf(",")) for (var a = s.split(","), u = 0; u < a.length; u++) t.sub(a[u], o);
        else r[s] || (r[s] = []),
        r[s].push({
            callback: o,
            times: l
        });
        return ! 0
    },
    t.unSub = function(t, e) {
        if (t = i(t), -1 != t.indexOf(" ")) {
            var s = t.replace(/\s+/g, " ").split(" ").sort().join(",");
            if (n[s]) if (e) for (var o = 0; o < n[s].callback.length; o++) n[s].callback[o].callback === e && (n[s].callback.splice(o, 1), o--);
            else n[s] = void 0,
            delete n[s]
        } else if (r[t]) if (e) for (var o = 0; o < r[t].length; o++) r[t][o].callback === e && (r[t].splice(o, 1), o--);
        else r[t] = void 0,
        delete r[t];
        return ! 0
    },
    t.subOnce = function(t, e) {
        return this.sub(t, e, 1)
    },
    t.subLock = function(t) {
        return s = t ? !0 : !1,
        this
    },
    t._getSubscribeData = function() {
        return {
            _callbackList: r,
            _andCallbackList: n,
            _lock: s
        }
    }
} (wxscreen),
function(t) {
    function e(t) {
        var e = typeof t;
        return "string" != e && "number" != e ? !1 : t ? !0 : !1
    }
    if (!t.MemoryStorage) {
        t.MemoryStorage = function() {
            this.clear()
        };
        var i = t.MemoryStorage.prototype;
        i.setItem = function(t, i) {
            return e(t) ? (this._store[t] = i, !0) : !1
        },
        i.getItem = function(t) {
            return e(t) ? this._store[t] : null
        },
        i.removeItem = function(t) {
            return e(t) ? (delete this._store[t], !0) : !1
        },
        i.clear = function() {
            return this._store = {},
            !0
        }
    }
} (wxscreen),
function(t) {
    function e() {
        return ! 0
    }
    function i() {
        for (var t = [], e = 0; e < localStorage.length; e++) t.push(localStorage.key(e));
        return t
    }
    if (!t.Storage && (t.MemoryStorage || window.localStorage)) {
        var r = "undefined" != typeof t.MemoryStorage,
        n = {};
        t.Storage = function(e, i) {
            this._ns = this._defNs = "An",
            this._nsInitialized = !1,
            this._type = "memory" == e ? "memory": "storage",
            this._isMemory = "memory" == this._type,
            "storage" != this._type || window.localStorage || (this._type = "memory", this._isMemory = !0),
            this._isMemory && !r && t.throwErr("wxscreen.MemoryStorage not initialized"),
            this._s = null,
            i && this.NS(i)
        };
        var s = t.Storage.prototype;
        s.NS = function(e) {
            return this._nsInitialized ? this: ("string" != typeof e && "number" != typeof e && t.throwErr("func s.NS param is not a string type", "TypeError"), e += "", -1 != e.indexOf(":") && t.throwErr('func s.NS param include char ":"', "SyntaxError"), e ? this._ns += ":" + e: this._ns = this._defNs, this._s = this._isMemory ? n[this._ns] ? n[this._ns] : n[this._ns] = new t.MemoryStorage: localStorage, this._nsInitialized = !0, this)
        },
        s._getNSList = function() {
            return n
        },
        s.set = function(e, i) {
            return this._nsInitialized || t.throwErr("sp.NS: NS failed ns not initialized"),
            "string" != typeof e && "number" != typeof e && t.throwErr("func s.set param is not a string type", "TypeError"),
            e += "",
            -1 != e.indexOf(":") && t.throwErr('func s.set param include char ":"', "SyntaxError"),
            e || t.throwErr("func s.set param key is empty", "TypeError"),
            this._isMemory || "object" != typeof i || (i = JSON.stringify(i)),
            this._isMemory || (e = this._ns + ":" + e),
            this._s.setItem(e, i),
            this
        },
        s.get = function(e) { ("string" != typeof e && "number" != typeof e || !e) && (t.log("sp.get key", e), t.throwErr("func s.get param is not a string type or is empty", "TypeError")),
            this._isMemory || (e = this._ns + ":" + e);
            var i = this._s.getItem(e);
            return this._isMemory || !i || "string" != typeof i || 0 != i.indexOf("{") && 0 != i.indexOf("[") || (i = JSON.parse(i)),
            i
        },
        s["delete"] = function(e) {
            return ("string" != typeof e && "number" != typeof e || !e) && t.throwErr("func s.set param is not a string type or is empty", "TypeError"),
            this._isMemory || (e = this._ns + ":" + e),
            this._s.removeItem(e),
            this
        },
        s.deleteNs = function() {
            if (this._isMemory) return this._s.clear(),
            !0;
            for (var t = this.getNSKeys(), i = 0; i < t.length; i++) this._s.removeItem(t[i]),
            e(t[i]);
            return ! 0
        },
        s.getNSKeys = function() {
            if (this._isMemory) return ! 1;
            for (var t = i(), e = [], r = 0; r < t.length; r++) 0 == t[r].indexOf(this._ns) && e.push(t[r]);
            return e
        }
    }
} (wxscreen),
function(t) {
    if (!t.LinkList) {
        t.Storage || t.throwErr("LinkList module depend on Storage module"),
        t.LinkList = function(i) {
            "object" != typeof i && t.throwErr("LinkList param is not a Object type", "TypeError"),
            this._storeType = e[i.storeType],
            ("undefined" == typeof this._storeType || this._storeType < 0) && t.throwErr("LinkList param storeType is undefined", "TypeError"),
            this._storeName = i.storeType,
            this._name = "string" == typeof i.name && i.name ? i.name: t.throwErr("LinkList param name is undefined", "TypeError"),
            this._unique = "string" == typeof i.unique && i.unique ? i.unique: null,
            1 == this._storeType && (this._storage = "memoryStorage" == this._storeName ? new t.Storage("memory", "l-" + this._name) : new t.Storage("storage", "l-" + this._name)),
            this._init_head(),
            this._init_length()
        };
        var e = {
            memory: 0,
            storage: 1,
            memoryStorage: 1
        },
        i = t.LinkList.prototype;
        i._init_head = function() {
            var t;
            return 0 == this._storeType ? t = this._generateElem("head") : 1 == this._storeType && (t = this._storage.get("headElem"), t || (t = this._generateElem("head"), this._storage.set("headElem", t))),
            this._head = t,
            t
        },
        i.checkUnique = function(t) {
            if (this._unique && t[this._unique]) {
                var e = {};
                e[this._unique] = t[this._unique];
                var i = this.search(e);
                if (i) return ! 1
            }
            return ! 0
        },
        i.insertAfterIndex = function(e, i) {
            this.checkUnique(e) || t.throwErr("in lp.insertAfter unique check failed " + JSON.stringify(e));
            var r = this._generateElem(e);
            0 > i && t.throwErr("List insertAfter failed: index < 0", "Error");
            var n = this.length();
            i > n && t.throwErr("List insertAfter failed: index > List length", "Error");
            var s = !1,
            o = this.getElemByIndex(i),
            l = this.getElemByPointer(o.next);
            return r.prev = o.cid,
            r.next = l ? l.cid: "",
            l ? l.prev = r.cid: (this._head.prev = r.cid, s = !0),
            o.next = r.cid,
            s ? this._saveChanged(o, r, l, this._head) : this._saveChanged(o, r, l),
            this._lengthHandler(1),
            this.length()
        },
        i.push = function(t) {
            return this.insertAfterIndex(t, this.length())
        },
        i.unshift = function(t) {
            return this.insertAfterIndex(t, 0)
        },
        i.deleteByIndex = function(e) { (1 > e || e > this.length()) && t.throwErr("func lp.deleteByIndex param index is overflow.", "Error");
            var i = this.getElemByIndex(e),
            r = this.getElemByPointer(i.prev),
            n = this.getElemByPointer(i.next),
            s = !1;
            return n ? (r.next = n.cid, n.prev = r.cid) : (r.next = "", this._head.prev = r.cid, s = !0),
            s ? this._saveChanged(r, n, this._head) : this._saveChanged(r, n),
            this._remove(i),
            this._lengthHandler( - 1),
            i
        },
        i.deleteByCid = function(t) {
            var e = this.getElemByPointer(t);
            if (!e) return ! 1;
            var i = this.getElemByPointer(e.prev),
            r = this.getElemByPointer(e.next),
            n = !1;
            return r ? (i.next = r.cid, r.prev = i.cid) : (i.next = "", this._head.prev = i.cid, n = !0),
            n ? this._saveChanged(i, r, this._head) : this._saveChanged(i, r),
            this._remove(e),
            this._lengthHandler( - 1),
            e
        },
        i.pop = function() {
            var t = this.length();
            if (t > 0) {
                var e = this.deleteByIndex(t);
                if (e) return e
            }
            return ! 1
        },
        i.shift = function() {
            var t = this.length();
            if (t > 0) {
                var e = this.deleteByIndex(1);
                if (e) return e
            }
            return ! 1
        },
        i["delete"] = function(e, i) {
            if ("string" != typeof e && "number" != typeof e && t.throwErr("LinkList.delete param field is not a string,number type"), "string" != typeof i && "number" != typeof i && t.throwErr("LinkList.delete param val is not a string,number type"), this._unique && e == this._unique) return this.deleteByCid(i),
            1;
            var r;
            e ? (r = {},
            r[e] = i) : r = i;
            var n = this.search(r, !0);
            if (!n) return 0;
            if (!n.length) return this.deleteByCid(n.cid),
            1;
            for (var s = 0; s < n.length; s++) this.deleteByCid(n[s].cid);
            return n.length
        },
        i.edit = function(t, e) {
            if ("stirng" == typeof t || "number" == typeof t) {
                if (i = this.getElemByPointer(t), !i) return 0
            } else {
                var i = this.search(t, !0);
                if (!i) return 0
            }
            i.length || (i = [i]);
            for (var r = 0,
            n = 0; n < i.length; n++) {
                var s = i[n].data;
                for (var o in e)"undefined" != typeof s[o] && (s[o] = e[o]);
                i[n].data = s,
                this._saveChanged(i[n]),
                r++
            }
            return r
        },
        i.clear = function() {
            return 1 == this._storeType && this._storage.deleteNs(),
            this._init_head(),
            this._init_length(),
            !0
        },
        i.search = function(t, e, i) {
            if (t && this._unique && t[this._unique]) {
                var r = this.getElemByPointer(t[this._unique]);
                return r ? e ? r: r.data: !1
            }
            for (var n, s, r = [], o = this.length(), l = typeof t, a = !isNaN(i), d = !1, u = 1; o >= u; u++) {
                n = this.getElemByIndex(u),
                s = typeof n.data;
                var h = e ? n: n.data;
                if ("undefined" == l) {
                    if (r.push(h), a && r.length >= i) break
                } else if ("string" != s && "number" != s || "string" != l && "number" != l || t != n.data) {
                    if ("object" == s && "object" == l) {
                        d = !1;
                        for (var _ in t) if ("undefined" != typeof n.data[_] && t[_] != n.data[_]) {
                            d = !0;
                            break
                        }
                        if (d === !1 && (r.push(h), a && r.length >= i)) break
                    }
                } else if (r.push(h), a && r.length >= i) break
            }
            return 0 == r.length ? !1 : 1 == r.length ? r[0] : r
        },
        i.sort = function(e, i) {
            "string" == typeof e && e || t.throwErr("lp.sort param field is empty or TypeError", "TypeError"),
            i ? (i = i.toLowerCase(), "asc" != i && "desc" != i && t.throwErr("lp.sort param flag is not supported", "Error")) : i = "asc";
            var r = this.length();
            if (!r || 2 > r) return ! 0;
            if (!this._lock()) return ! 1;
            try {
                for (var n = [], s = 1; r >= s; s++) n.push(this.getElemByIndex(s));
                if (!n.length) return this._unlock(),
                !0; ("object" != typeof n[0].data || "undefined" == typeof n[0].data[e]) && (this._unlock(), t.throwErr("lp.sort param " + e + " is not exists", "Error")),
                n.sort(function(t, r) {
                    return isNaN(t.data[e]) || (t.data[e] += ""),
                    isNaN(r.data[e]) || (r.data[e] += ""),
                    t.data[e] == r.data[e] ? 0 : "asc" == i ? t.data[e] < r.data[e] ? -1 : 1 : t.data[e] < r.data[e] ? 1 : -1
                }),
                t.DEBUG,
                this._head.next = n[0].cid;
                for (var s = 1; s < n.length; s++) n[s].next = n[s + 1] ? n[s + 1].cid: "",
                n[s].prev = n[s - 1].cid,
                this._saveChanged(n[s]);
                return this._saveChanged(n[0]),
                this._saveChanged(this._head),
                this._unlock(),
                !0
            } catch(o) {
                throw this._unlock(),
                o
            }
        },
        i._saveChanged = function() {
            if (arguments.length && 1 == this._storeType) for (var t = 0; t < arguments.length; t++) arguments[t] && "undefined" != typeof arguments[t].cid && ("head" == arguments[t].data ? this._storage.set("headElem", arguments[t]) : this._storage.set(arguments[t].cid, arguments[t]));
            return ! 0
        },
        i._remove = function(t) {
            return t && "undefined" != typeof t.cid && 1 == this._storeType ? this._storage["delete"](t.cid) : !0
        },
        i._generateElem = function(t) {
            var e = {
                data: t,
                prev: "",
                next: ""
            };
            return e.cid = "head" == t ? 0 : this._getPointer(e),
            e
        },
        i._getPointer = function(e) {
            if (0 == this._storeType) return e;
            if (1 == this._storeType) {
                if (this._unique) return e.data[this._unique] || t.throwErr("lp._getPointer elem has no unique id"),
                e.data[this._unique];
                var i = this._storage.get("cid");
                return i ? i++:i = 1,
                this._storage.set("cid", i),
                i
            }
        },
        i.getElemByIndex = function(e) {
            if (0 == e) return this._head;
            if ((1 > e || e > this.length()) && t.throwErr("List insertAfter failed: index > List length or index < 1", "Error"), e == this.length()) return this.getElemByPointer(this._head.prev);
            for (var i = this._head,
            r = 0; i.next;) if (i = this.getElemByPointer(i.next), r++, e == r) return i;
            return ! 1
        },
        i.getDataByIndex = function(t) {
            var e = this.getElemByIndex(t);
            return e && "head" != e.data ? e.data: !1
        },
        i.getElemByPointer = function(t) {
            return 0 == this._storeType && t ? t: 1 == this._storeType ? 0 == t ? this._head: this._storage.get(t) : !1
        },
        i.length = function() {
            if (0 == this._storeType) return this._length;
            if (1 == this._storeType) {
                var t = this._storage.get("listLength");
                return isNaN(t) ? !1 : parseInt(t)
            }
        },
        i._lengthHandler = function(t) {
            if (0 == this._storeType) return this._length += t,
            this._length;
            if (1 == this._storeType) {
                var e = this.length();
                return e || (e = 0),
                e += t,
                this._storage.set("listLength", e),
                e
            }
        },
        i._init_length = function() {
            return 0 == this._storeType ? (this._length = 0, this._length) : 1 == this._storeType ? this._lengthHandler(0) : void 0
        },
        i._lock = function() {
            if (0 == this._storeType) return ! 0;
            var t = this._storage.get("listLock");
            return 1 == t ? !1 : (t || this._storage.set("listLock", 1), !0)
        },
        i._unlock = function() {
            return 0 == this._storeType ? !0 : (this._storage["delete"]("listLock"), !0)
        }
    }
} (wxscreen),
function(t) {
    function e(t, e, i, r) {
        a && (a.beginPath(), a.lineWidth = y, a.strokeStyle = r, a.arc(0, 0, t, e, i, !1), a.stroke())
    }
    function i(t) {
        l.innerHTML = t
    }
    if (!t.progress) {
        var r, n, s, o, l, a, d, u, h, _ = t.progress = {
            _timer: null,
            state: null
        },
        c = -Math.PI / 2,
        f = -Math.PI / 2,
        g = 2 * Math.PI,
        p = f + g,
        m = 18,
        y = 2,
        v = !1;
        _.step = function() {
            var s = Math.ceil((p - f) / g * n);
            return 0 == s ? t.pub("event.progress.compelete") : t.getConf("isV6") || i(s),
            p > f ? (e(m, f, f + u, h), f += u) : (a && a.clearRect( - 30, -30, 60, 60), e(18, 0, 2 * Math.PI, r[1]), f = c),
            this
        },
        _.restart = function(t) {
            return this.stop().start(t)
        },
        _.start = function(t) {
            var e = this;
            return clearInterval(this._timer),
            this._timer = setInterval(function() {
                e.step()
            },
            s),
            this.state = "running",
            t && t(),
            this
        },
        _.stop = function(t) {
            return clearInterval(this._timer),
            v || (a && a.translate(25, 25), v = !0),
            a && a.clearRect( - 30, -30, 60, 60),
            e(18, 0, g, r[1]),
            f = c,
            this.state = "stoped",
            t && t(),
            this
        },
        _.pause = function(t) {
            return clearInterval(this._timer),
            this.state = "paused",
            t && t(),
            this
        },
        _.resume = function(t) {
            return this.start(t)
        },
        _.init = function() {
            return r = t.getConf("timerColorMap"),
            n = t.getConf("autoTime"),
            s = t.getConf("stepTime"),
            o = document.getElementById("cirProgress"),
            l = document.getElementById("remainTime"),
            a = o.getContext ? o.getContext("2d") : null,
            d = 1e3 * n,
            u = g / d * s,
            h = r[0],
            y = t.getConf("isV6") ? 2 : 5,
            this.stop(),
            this
        }
    }
} (wxscreen),
function(t) {
    if (!t.btnKeys) {
        var e = t.btnKeys = {},
        i = {
            13 : "key.enter.down",
            32 : "key.whitespace.down",
            37 : "key.left.down",
            38 : "key.up.down",
            39 : "key.right.down",
            40 : "key.down.down"
        };
        e.init = function() {
            return $ || t.throwErr("btnKeys depend on jQuery"),
            this.bindBtns().bindKeys(),
            this
        },
        e.bindBtns = function() {
            return $(".btnFullScreen").click(function(e) {
                e.preventDefault(),
                e.stopPropagation();
                var i = document.documentElement,
                r = i.webkitRequestFullscreen || i.requestFullScreen || i.webkitRequestFullScreen || i.mozRequestFullScreen;
                r && r.call(i),
                t.pub("control.btn.btnFullScreen.clicked", e)
            }),
            $(".btnPause").click(function(e) {
                var i = t.getConf("template");
                "paused" == t.progress.state || "stoped" == t.progress.state ? (t.progress.resume(), "bo2" == i ? $(this).removeClass("btn-resume").addClass("btn-pause") : t.getConf("isV6") ? $(this).removeClass("btn-pause") : $(this).text("暂停")) : (t.progress.pause(), "bo2" == i ? $(this).removeClass("btn-pause").addClass("btn-resume") : t.getConf("isV6") ? $(this).addClass("btn-pause") : $(this).text("启动")),
                t.pub("control.btn.btnPause.clicked", e)
            }),
            $(".btnNewest").click(function(e) {
                t.pub("control.btn.btnNewest.clicked", e)
            }),
            $(".btnOldest").click(function(e) {
                t.pub("control.btn.btnOldest.clicked", e)
            }),
            $(".btnPrev").click(function(e) {
                t.pub("control.btn.btnPrev.clicked", e)
            }),
            $(".btnNext").click(function(e) {
                t.pub("control.btn.btnNext.clicked", e)
            }),
            this
        },
        e.bindKeys = function() {
            $(document).on("keydown",
            function(e) {
                var r = e.keyCode ? e.keyCode: e.which;
                i.hasOwnProperty(r) ? t.pub(i[r], e) : t.pub("key." + r + ".down", e)
            })
        }
    }
} (wxscreen),
function(t) {
    if (!t.message) {
        t.LinkList || t.throwErr("module message depend on module LinkList"),
        t.progress || t.throwErr("module message depend on module progress"),
        jQuery || t.throwErr("module message depend on jQuery");
        var e = t.message = {
            _total: 0,
            _tag_id: 0,
            _tag_relation_ids: [],
            _linkList: null,
            _linkListPlayed: null,
            _storate: null,
            _playedStoreIds: [],
            _lastId: 0,
            _syncProgress: "stoped",
            _pullTimer: null,
            _ajaxObj: null,
            _progressTimer: null,
            _currentDomList: [],
            _currentList: [],
            _laterOffWallList: [],
            _scrollSpeed: 800,
            _scrollState: "stoped",
            _tmpProgressState: null,
            _scrollType: "next",
            _scrollPrevPointer: null,
            _transitions: null,
            _dom_scrollBox: null,
            _dom_totalBox: null,
            _liHeight: null
        };
        e.init = function(e, i, r, n) {
            var s = this;

                this._tag_id = parseInt(n) || 0;

            var o = "memoryStorage";

            if (this._linkList = new t.LinkList({
                name: "m-" + t.getConf("companyId"),
                storeType: o,
                unique: "id"
            }), this._linkListPlayed = new t.LinkList({
                name: "mp-" + t.getConf("companyId"),
                storeType: o,
                unique: "id"
            }), this._linkList.clear(), this._linkListPlayed.clear(), this._storate = new t.Storage("storage", "msg-played-" + t.getConf("companyId")), this._playedStoreIds = this._tag_id ? [] : this._storate.get("ids") || [], this._transitions = function(t) {
                var e = ["transformProperty", "WebkitTransform", "MozTransform", "OTransform", "msTransform"];
                for (var i in e) if (void 0 !== t.style[e[i]]) return ! 0;
                return ! 1
            } (document.createElement("div")), this._dom_totalBox = $(".messageTotal"), this._dom_scrollBox = $(".scrollBox ul"), this._dom_scrollBox.css({
                position: "relative"
            }).parent().css({
                visibility: "visible",
                overflow: "hidden",
                position: "relative"
            }), this.bindEvent(), this.add(i), t.setState("message"), i && i.length) {
                var l = i.slice(0, t.getConf("visibleNum")),
                a = this.renderList(l);
                this._dom_scrollBox.html(a),
                this._liHeight = t._height(this._dom_scrollBox.children("li:eq(0)")),
                this._transitions || this._dom_scrollBox.height(this._dom_scrollBox.children("li").length * this._liHeight);
                for (var d = [], u = 0; u < l.length; u++) d.push(l[u].id);
                this.addToPlayed(d),
                this.afterScrollEnd()
            }
            return this.renderTotal(r),
            this._playedIdsTimer = setInterval(function() {
                s.savePlayedIds()
            },
            15e3),
            t.subOnce("message.addCompleted",
            function() {
                t.getConf("isCycleScroll") || s._linkList.length() || (s.sort(), s.scrollPrev(), t.DEBUG && t.log("subOnce: message.addCompleted"))
            }),
            this
        },
        e.savePlayedIds = function() {
            this._storate.set("ids", this._playedStoreIds)
        },
        e.pullStop = function() {
            return clearTimeout(this._pullTimer),
            this._pullTimer = null,
            this._ajaxObj && this._ajaxObj.abort(),
            this._ajaxObj = null,
            this
        },
        e.pull = function() {
            var e = this;
            return this.pullStop(),
            this.sync(function(i) {
                i && t.DEBUG && t.log("message.pull: sync return err:", i);
                var r = e._linkList.length();
                if (e._dom_scrollBox.children("li").length < t.getConf("visibleNum") && r) {
                    var n = e._linkList.search();
                    n && !n.length && (n = [n]);
                    for (var s = "",
                    o = 0; o < n.length; o++) 0 != n[o].is_on_wall && (2 == n[o].is_on_wall && e._linkList.edit(n[o].id, {
                        is_on_wall: 1
                    }), s += e.renderOne(n[o]));
                    e._dom_scrollBox.html(s),
                    e._liHeight || (e._liHeight = t._height(e._dom_scrollBox.find("li:eq(0)"))),
                    e._transitions || e._dom_scrollBox.height(e._dom_scrollBox.children("li").length * e._liHeight),
                    e.afterScrollEnd()
                } else e.length() || e._dom_scrollBox.html("");
                e._pullTimer = setTimeout(function() {
                    e.pull()
                },
                5e3)
            }),
            this
        },
        e.sync = function(e) {
            var i = location.hostname;
            if ( - 1 == i.indexOf("wxscreen.sinaapp.com") && -1 == i.indexOf("wxscreen.com")){ 
                //return window.location.reload();
            }
            
            if ("started" == this._syncProgress) return e("started");
            this._syncProgress = "started";
            var r, n = this._lastId,
            s = this;
            return e = e || t.loop,
            r = {
                last_id: n,
                tag_id: this._tag_id,
                tag_relation_ids: this._tag_relation_ids
            },
            this._ajaxObj = $.post(t.url("user/sync"), r,
            function(i) {
                t.pub("network.ok");
                var r = null,
                    n = !1;

                "ok" != i.info ? r = i.info : (i.message_list && s.add(i.message_list), i.off_wall_ids && s.offWall(i.off_wall_ids), 0 == i.all_total && (s._linkList.clear(), s._linkListPlayed.clear()), s.renderTotal(i.all_total), n = !0),

                s._syncProgress = "stoped",
                e(r, n)
            },
            "json").error(function(i, r, n) {
                t.DEBUG && t.log("message.sync ajax-error: jqXHR, textStatus, errorThrown ", i, r, n),
                s._syncProgress = "stoped",
                i.readyState < 2 && "error" == r && t.pub("network.disconnected", i),
                e("ajax-error:" + r)
            }),
            this
        },
        e.add = function(e) {
            if (!e || !e.length) return t.pub("message.addCompleted"),
            !1;
            this._lastId = this._tag_id ? e[e.length - 1].tag_relation_id: e[e.length - 1].update_time_ms;
            for (var i = 0; i < e.length; i++) if (t.preLoadAvatar(e[i].avatar), e[i].photo_small && t.loadImage(e[i].photo_small), this._tag_id || -1 == t.inArray(e[i].id, this._playedStoreIds) || this.getElem(e[i].id, this._linkListPlayed)) {
                var r = this.getElem(e[i].id, this._linkList);
                r ? r.data.update_time_ms < e[i].update_time_ms ? (this._linkList["delete"]("id", e[i].id), this._linkList.push(e[i])) : this._linkList.edit({
                    id: e[i].id
                },
                e[i]) : 2 == e[i].is_on_wall ? this._linkList.unshift(e[i]) : this._linkList.push(e[i]),
                this._tag_id && e[i].tag_relation_id && t.uniqueInsert(e[i].tag_relation_id, this._tag_relation_ids)
            } else this._linkListPlayed.push(e[i]);
            return this
        },
        e.addToPlayed = function(e) {
            if (!e.length) return ! 1;
            var i = t.getConf("visibleNum");
            if (this.length() <= i) return ! 1;
            for (var r = 0; r < e.length; r++) {
                var n = this.info(e[r]);
                if (n) {
                    this._linkList["delete"]("id", e[r]);
                    for (var s = 0; s < this._currentList.length; s++) this._currentList[s].data.id == e[r] && (this._currentList.splice(s, 1), s--);
                    this.getElem(e[r], this._linkListPlayed) || this._linkListPlayed.push(n),
                    this._tag_id || t.uniqueInsert(e[r], this._playedStoreIds)
                }
            }
            for (; this._linkListPlayed.length() > t.getConf("maxMessageNum");) this._linkListPlayed.shift();
            for (var o = 30 * t.getConf("maxMessageNum"); this._playedStoreIds.length > o;) this._playedStoreIds.shift()
        },
        e.offWall = function(e) {
            if (!e || !e.length) return ! 1;
            for (var i = t.getConf("visibleNum"), r = 0; r < e.length; r++) {
                if (t.deleteByElem(e[r], this._playedStoreIds), t.deleteByElem(e[r], this._tag_relation_ids), -1 != t.inArray(e[r], this._currentDomList) || e[r] == t.messageDetail._currentId || e[r] == this._scrollPrevPointer) {
                    if (this.length() > i) {
                        this._laterOffWallList.push(e[r]);
                        continue
                    }
                    try {
                        this._dom_scrollBox.find('li[data-id="' + e[r] + '"]').remove(),
                        "messageDetail" == t.getState() && t.messageDetail.hide()
                    } catch(n) {}
                }
                if (this._linkList["delete"]("id", e[r]), this._linkListPlayed["delete"]("id", e[r]), this._currentList.length) for (var s = 0; s < this._currentList.length; s++) this._currentList[s].data.id == e[r] && (this._currentList.splice(s, 1), s--)
            }
            return ! 0
        },
        e.newest = function(e) {
            e = e || 1;
            var i, r, n = [];
            for (e > this.length() && (e = this.length()); n.length < e && (i = this._linkList.pop());) n.unshift(i);
            for (; t.getConf("isCycleScroll") && n.length < e && (r = this._linkListPlayed.shift());) n.push(r);
            return this._currentList = this._currentList.concat(n),
            1 == e ? n[0] : n
        },
        e.oldest = function(t) {
            t = t || 1;
            var e, i = [];
            for (t > this.length() && (t = this.length()); i.length < t && (e = this._linkListPlayed.shift());) i.push(e);
            return this._currentList = this._currentList.concat(i),
            1 == t ? i[0] : i
        },
        e.next = function(e) {
            e = e || 1;
            var i, r, n = [];
            for (e > this.length() && (e = this.length()); n.length < e && (i = this._linkList.shift());) n.push(i);
            for (; t.getConf("isCycleScroll") && n.length < e && (r = this._linkListPlayed.shift());) n.push(r);
            return this._currentList = this._currentList.concat(n),
            1 == e ? n[0] : n
        },
        e.prev = function(e) {
            e = e || 1;
            var i, r, n, s = [];
            if (e > this.length() && (e = this.length()), this._scrollPrevPointer) if (r = this.getElem(this._scrollPrevPointer, this._linkListPlayed)) for (n = r; s.length < e && (i = this.getElem(n.prev, this._linkListPlayed));) s.unshift(i),
            n = i;
            else t.DEBUG && t.log("message.prev elemPointer is null");
            for (n = this._linkListPlayed._head; s.length < e && (i = this.getElem(n.prev, this._linkListPlayed));) s.unshift(i),
            n = i;
            return r = s[0],
            this._scrollPrevPointer = r.data.id,
            1 == e ? s[0] : s
        },
        e.indexOf = function(t) {
            return this._linkList.getDataByIndex(t)
        },
        e.info = function(t) {
            if (!t || isNaN(t)) return ! 1;
            var e = this.getElem(t, this._linkList);
            if (e || (e = this.getElem(t, this._linkListPlayed)), !e) for (var i = 0; i < this._currentList.length; i++) if (this._currentList[i].data.id == t) {
                e = this._currentList[i];
                break
            }
            return e ? e.data: !1
        },
        e.getElem = function(t, e) {
            var i = e.getElemByPointer(t);
            return i && "head" != i.data ? i: !1
        },
        e.length = function() {
            return this._total
        },
        e.sort = function() {
            return this._linkList.sort("update_time_ms", "asc"),
            this._linkListPlayed.sort("update_time_ms", "asc"),
            this
        },
        e.renderTotal = function(t) {
            return isNaN(t) || (this._total = parseInt(t)),
            t = t || this.length(),
            this._dom_totalBox.text(t),
            this
        },
        e.renderList = function(t) {
            if (!t.length) return "";
            for (var e = "",
            i = 0; i < t.length; i++) e += this.renderOne(t[i]);
            return e
        },
        e.renderOne = function(e) {
            if (!e) return "";
            var i = !!e.photo_small,
            r = t.getConf("visibleNum"),
            n = this.getFontSize(e.content, r),
            s = 3 == r ? 'style="max-width:158px;max-height:112px;display:block;"': 'style="max-width:600px;max-height:160px;display:block;"',
            o = "",
            l = "";
            if (i ? l = "<img " + (3 == r ? 'class="with-map msgImage"': 'class="msgImage"') + ' src="' + e.photo_small + '" ' + s + " />": o = '<span class="cont displayContent" style="font-size:' + n + 'px;">' + e.content + "</span>", i && 3 == r ? e.content = "分享一张照片：": i && (e.content = l), e.user_id) {
                var a = t.user.info(e.user_id);
                a && (e.avatar = a.avatar)
            }
            return html = '      <li class="clearfix ' + (3 == r ? "t-row": "") + '" data-id="' + e.id + '" data-update_time_ms="' + e.update_time_ms + '">        <a href="javascript:void(0);" class="head left"><img class="msgAvatar" src="' + e.avatar + '" width="100" height="100" alt=""></a>        <div class="cont-box left">          <p class="c-word">            <a href="javascript:void(0);" class="user-name msgUserName">' + e.username + ":</a>            " + (i && 2 == r ? l: o) + "          </p>          " + (3 == r && i ? l: "") + '        </div>        <div class="btn-detail messageDetailBtn" style="display: none;">          <div class="btn-style">            <a href="javascript:void(0);" class="icon-arrow"></a>          </div>        </div>      </li>'
        },
        e.renderLi = function(t, e) {
            return t.after(this.renderOne(e)).remove(),
            this
        },
        e.getFontSize = function(e, i) {
            e = t.trim(e),
            -1 != e.indexOf("<img") && (e = e.replace(/\<img.+?\>/g, "") ? e.replace(/\<img.+?\>/g, "11") : "");
            var r = t.fontNum(e);
            if (!r) return 16;
            var n = 3 == i ? 55 : 120;
            if (3 == i) var s = Math.sqrt(56e3 / r) / 1.6;
            else var s = Math.sqrt(117600 / r) / 1.6;
            return s > n && (s = n),
            s
        },
        e.setScrollType = function(t) {
            this._scrollType = t,
            "prev" != t && (this._scrollPrevPointer = null)
        },
        e.getScrollType = function() {
            return this._scrollType
        },
        e.scrollCheck = function() {
            return "running" == this._scrollState ? (t.DEBUG && t.log("message.scrollCheck is running"), !1) : this._currentDomList.length ? this.length() > t.getConf("visibleNum") ? !0 : (0 == this.length() && this._dom_scrollBox.html(""), t.DEBUG && t.log("message.scrollCheck message.length <= visibleNum"), !1) : (t.DEBUG && t.log("message.scrollCheck _currentDomList.length == 0"), !1)
        },
        e.renderScroll = function(e, i) {
            var r = Math.abs(this._dom_scrollBox.attr("data-to") || 0) / this._liHeight,
            n = this._dom_scrollBox.children("li:eq(" + r + ")"),
            s = r + this._currentDomList.length - 1,
            o = this._dom_scrollBox.children("li:eq(" + s + ")");
            n && o && n.length && o.length || t.throwErr("message.renderScroll firstLi or lastLi not exists");
            for (var l = "",
            a = [], d = 0; d < e.length; d++) e[d].data || (e[d].data = e[d]),
            a.push(e[d].data.id),
            l += this.renderOne(e[d].data);
            if (!l) return t.DEBUG && t.log("message.renderScroll failed: html is empty. isCycleScroll:", t.getConf("isCycleScroll")),
            !1;
            if (o.nextAll("li").remove(), n.prevAll("li").remove(), this.scrollFn(this._dom_scrollBox, 0, 0), "prev" == i || "oldest" == i) {
                if (a.slice(0, this._currentDomList.length).join(",") == this._currentDomList.join(",")) return this._scrollState = "stoped",
                !1;
                n.before(l),
                this.scrollFn(this._dom_scrollBox, -e.length * this._liHeight, 0),
                this.scrollFn(this._dom_scrollBox, 0)
            } else {
                if (a.slice(a.length - this._currentDomList.length).join(",") == this._currentDomList.join(",")) return this._scrollState = "stoped",
                this["scroll" + (i.slice(0, 1).toUpperCase() + i.slice(1))](),
                !1;
                o.after(l),
                this.scrollFn(this._dom_scrollBox, -e.length * this._liHeight)
            }
            return this
        },
        e.scrollNext = function() {
            if (!this.scrollCheck()) return ! 1;
            var e = this.next(t.getConf("visibleNum"));
            return this.setScrollType("next"),
            this.renderScroll(e, "next")
        },
        e.scrollPrev = function() {
            if (!this.scrollCheck()) return ! 1;
            var e = this.prev(t.getConf("visibleNum"));
            return this.setScrollType("prev"),
            this.renderScroll(e, "prev")
        },
        e.scrollNewest = function() {
            if (!this.scrollCheck()) return ! 1;
            var e = this.newest(2 * t.getConf("visibleNum"));
            return this.setScrollType("newest"),
            this.renderScroll(e, "newest")
        },
        e.scrollOldest = function() {
            if (!this.scrollCheck()) return ! 1;
            var e = this.oldest(2 * t.getConf("visibleNum"));
            return this.setScrollType("oldest"),
            this.renderScroll(e, "oldest")
        },
        e.beforeScrollStart = function() {
            return this._tmpProgressState = t.progress.state,
            this.pause()
        },
        e.pause = function() {
            return "running" == t.progress.state && $(".btnPause").trigger("click"),
            !0
        },
        e.off = function() {
            this.pause(),
            this.pullStop()
        },
        e.on = function() {
            this.resume(),
            this.pull()
        },
        e.resume = function() {
            return "paused" == t.progress.state && $(".btnPause").trigger("click"),
            !0
        },
        e.afterScrollEnd = function() {
            this._scrollState = "stoped",
            t.pub("message.afterScrollEnd");
            var e = this._dom_scrollBox.attr("data-to") || 0,
            i = Math.abs(e) / this._liHeight;
            if (0 == i) var r = this._dom_scrollBox.children("li:lt(" + t.getConf("visibleNum") + ")");
            else var r = this._dom_scrollBox.children("li:gt(" + (i - 1) + "):lt(" + (i + t.getConf("visibleNum")) + ")");
            var n = this;
            this._currentDomList = [],
            $.each(r,
            function() {
                var t = $(this);
                n._currentDomList.push(t.attr("data-id"))
            }),
            "running" == this._tmpProgressState ? this.resume() : this.pause()
        },
        e.scrollFn = function(t, e, i) {
            var r = this,
            n = "animate";
            this._transitions && (n = "translate"),
            "translate" != n && this._dom_scrollBox.height(this._dom_scrollBox.children("li").length * this._liHeight),
            t.attr("data-to", e),
            this._scrollState = "running",
            r[n](t, e, i)
        },
        e.translate = function(t, e, i) {
            if (i = "undefined" == typeof i ? this._scrollSpeed: i, 0 != i && this.beforeScrollStart() === !1) return ! 1;
            var r = this;
            return 0 == i ? t.css({
                y: e + "px"
            }) : t.transition({
                y: e + "px"
            },
            i,
            function() {
                r.afterScrollEnd()
            }),
            this
        },
        e.animate = function(t, e, i) {
            if (0 === i) return t.css("top", e + "px"),
            this;
            if (this.beforeScrollStart() === !1) return ! 1;
            var r = this;
            return i = "undefined" == typeof i ? this._scrollSpeed: i,
            t.animate({
                top: e
            },
            i,
            function() {
                r.afterScrollEnd()
            }),
            this
        },
        e.bindEvent = function() {
            var e = this;
            t.sub("event.progress.compelete",
            function() {
                "message" == t.getState() && e.scrollNext()
            }),
            t.sub("control.btn.btnNewest.clicked, key.right.down",
            function() {
                "message" == t.getState() && ("running" == t.progress.state && t.progress.restart(), e.scrollNewest())
            }),
            t.sub("control.btn.btnOldest.clicked, key.left.down",
            function() {
                "message" == t.getState() && ("running" == t.progress.state && t.progress.restart(), e.scrollOldest())
            }),
            t.sub("control.btn.btnPrev.clicked, key.up.down",
            function() {
                "message" == t.getState() && ("running" == t.progress.state && t.progress.restart(), e.scrollPrev())
            }),
            t.sub("control.btn.btnNext.clicked, key.down.down",
            function() {
                "message" == t.getState() && ("running" == t.progress.state && t.progress.restart(), e.scrollNext())
            }),
            t.sub("key.whitespace.down",
            function() {
                var e = t.getState(); ("message" == e || "messageDetail" == e) && $(".btnPause").trigger("click")
            }),
            t.sub("message.afterScrollEnd, messageDetail.afterScrollEnd",
            function(i) {
                "message.afterScrollEnd" == i ? e.addToPlayed(e._currentDomList) : "messageDetail.afterScrollEnd" == i && e.addToPlayed([t.messageDetail._currentId]);
                for (var r = 0; r < e._laterOffWallList.length; r++) if ( - 1 == t.inArray(e._laterOffWallList[r], e._currentDomList) && e._laterOffWallList[r] != t.messageDetail._currentId && e._laterOffWallList[r] != this._scrollPrevPointer) {
                    if (e._linkList["delete"]("id", e._laterOffWallList[r]), e._linkListPlayed["delete"]("id", e._laterOffWallList[r]), e._currentList.length) for (var n = 0; n < e._currentList.length; n++) e._currentList[n].data.id == e._laterOffWallList[r] && (e._currentList.splice(n, 1), n--);
                    e._laterOffWallList.splice(r, 1),
                    t.deleteByElem(e._laterOffWallList[r], e._playedStoreIds),
                    r--
                }
            }),
            $(".btnStar").click(function() {
                t.pub("key.74.down")
            }),
            t.sub("key.74.down",
            function() {
                e._tag_id ? e.turnToTag(0) : e.turnToTag(1)
            })
        },
        e.turnToTag = function(e) {
            e = parseInt(e),
            this.off(),
            window.location.href = e ? t.url("message?tag_id=" + e) : t.url("message")
        }
    }
} (wxscreen),
function(t) {
    if (!t.user) {
        t.LinkList || t.throwErr("module user depend on module LinkList");
        var e = t.user = {
            _u: null,
            _m_ids: [],
            _f_ids: [],
            _o_ids: [],
            _ids: [],
            _pullTimer: null,
            _syncProgress: "stoped",
            _ajaxObj: null,
            _isReady: !1,
            _lotteryed_ids: [],
            _lotteryed_not_synced_ids: [],
            _lottery_deleted_not_synced_ids: [],
            _ddped_ids: [],
            _lottery_ids: [],
            _pre_lottery_ids: [],
            _pre_lottery_list: [],
            _ddp_ids: {
                _m_ids: [],
                _f_ids: []
            }
        };
        e.init = function() {
            this._u = new t.LinkList({
                name: "user-" + t.getConf("companyId"),
                storeType: "memoryStorage",
                unique: "id"
            }),
            this.pull(),
            this.lotteryPull(),
            this.ddpPull();
            var e = this;
            t.subOnce("user.ready user.lotterySynced user.ddpSynced",
            function() {
                for (var i = 0; i < e._lotteryed_ids.length; i++) t.deleteByElem(e._lotteryed_ids[i], e._lottery_ids);
                for (var i = 0; i < e._ddped_ids.length; i++) {
                    var r = e._ddped_ids[i].user_id,
                    n = e._ddped_ids[i].to_user_id;
                    t.deleteByElem(r, e._m_ids),
                    t.deleteByElem(n, e._f_ids)
                }
                e._isReady = !0,
                t.pub("user.all_ready")
            }),
            this.lotteryPollNotSynced(),
            this.lotteryShareToDom()
        },
        e.pullStop = function() {
            return clearTimeout(this._pullTimer),
            this._pullTimer = null,
            this._ajaxObj && this._ajaxObj.abort(),
            this._ajaxObj = null,
            this
        },
        e.pull = function() {
            if (!this.checkAuth()) return ! 1;
            this.pullStop();
            var e = this;
            return e.sync(function(i) {
                i && t.DEBUG && t.log("user.pull: sync return err:", i),
                e._pullTimer = setTimeout(function() {
                    e.pull()
                },
                5e3)
            }),
            this
        },
        e.sync = function(e) {


            if ("running" == this._syncProgress) return t.DEBUG && t.log("user.sync _syncProgress == running and return"),
            void 0;
            e = e || t.loop;

            //debugger;

            var i, r = this._u.getDataByIndex(this._u.length()),
                n = 0,
                s = this;

            r && (n = r.update_time_ms),
            i = {
                last_id: n
            },
            this._syncProgress = "running";

            this._ajaxObj = $.post(
                t.url("user/sync"), 
                i,
                function(i) {
                    var r = null,
                    n = !1;
                    "ok" != i.info ? r = i.info: (i.user_list && (i.user_list.length ? s.add(i.user_list) : t.pub("user.ready", s)), n = !0, t.pub("user.synced", s)),
                    s._syncProgress = "stoped",
                    t.pub("network.ok"),
                    e(r, n)
                },
                "json").error(
                    function(i, r, n) {
                        t.DEBUG && t.log("user.sync ajax-error: jqXHR, textStatus, errorThrown ", i, r, n),
                        s._syncProgress = "stoped",
                        i.readyState < 2 && "error" == r ? t.pub("network.disconnected", i) : t.pub("network.ok"),
                        e("ajax-error:" + r)
                    })
        },
        e.add = function(e) {
            if (e instanceof Array) for (var i = 0; i < e.length; i++) {
                var r = this._u.getElemByPointer(e[i].id);
                r ? r.data.update_time_ms < e[i].update_time_ms ? (this._u["delete"]("id", e[i].id), this._u.push(e[i])) : this._u.edit({
                    id: e[i].id
                },
                e[i]) : this._u.push(e[i]),
                1 == e[i].is_on_wall ? t.uniqueInsert(e[i].id, this._ids) : t.deleteByElem(e[i].id, this._ids),
                t.preLoadAvatar(e[i].avatar);
                var n = e[i].id,
                s = parseInt(e[i].is_on_wall);
                s ? 1 == e[i].gender ? (t.uniqueInsert(n, this._m_ids), t.deleteByElem(n, this._f_ids), t.deleteByElem(n, this._o_ids)) : 2 == e[i].gender ? (t.uniqueInsert(n, this._f_ids), t.deleteByElem(n, this._m_ids), t.deleteByElem(n, this._o_ids)) : (t.uniqueInsert(n, this._o_ids), t.deleteByElem(n, this._m_ids), t.deleteByElem(n, this._f_ids)) : (t.deleteByElem(n, this._m_ids), t.deleteByElem(n, this._f_ids), t.deleteByElem(n, this._o_ids))
            } else t.DEBUG && t.log("func user.add param list is not an Array type", e);
            return this
        },
        e.length = function() {
            return this._u.length()
        },
        e.info = function(t) {
            var e = this._u.getElemByPointer(t);
            return e ? e.data: !1
        },
        e.isInTimeArr = function(e, i) {
            var r = this.info(e);
            if (!r) return ! 1;
            var n = "0000-00-00 00:00:00" != r.on_wall_time ? r.on_wall_time: r.add_time;
            return n = Date.parse(t._generateDateStr(n)),
            n >= i[0] && n <= i[1] ? !0 : !1
        },
        e.random = function() {
            var e = this._ids.length - 1;
            if (0 > e) return ! 1;
            randId = this._ids[t.rand(0, e)];
            var i = this.info(randId);
            return i ? i: !1
        },
        e._lotteryPullTimer = null,
        e._lotteryPullNotSyncTimer = null,
        e._lotteryShareToDomTimer = null,
        e._lotteryPullAjaxObj = null,
        e.lotteryInitUser = function() {
            var e = t.parseVisibleTime("lottery");
            this._lottery_ids = [];
            for (var i = 0; i < this._ids.length; i++) this.isInTimeArr(this._ids[i], e) && -1 == t.inArray(this._ids[i], this._lotteryed_ids) && t.uniqueInsert(this._ids[i], this._lottery_ids);
            return ! 0
        },
        e.lotteryPullStop = function() {
            return clearTimeout(this._lotteryPullTimer),
            this._lotteryPullAjaxObj && (this._lotteryPullAjaxObj.abort(), this._lotteryPullAjaxObj = null),
            this
        },
        e.lotteryPull = function() {
            var e = this;
            return this.lotteryPullStop(),
            this.checkAuth("lotteryPlug") ? t.getConf("isDemo") ? (this._lotteryPullTimer = setTimeout(function() {
                e.lotteryInitUser(),
                t.pub("user.lotterySynced")
            },
            1e3), !1) : (e.lotterySync(function() {
                "lottery" == t.getState() && (e._lotteryPullTimer = setTimeout(function() {
                    e.lotteryPull()
                },
                1e3 * t.rand(7, 10)))
            }), void 0) : (this._lotteryPullTimer = setTimeout(function() {
                e.lotteryInitUser(),
                t.pub("user.lotterySynced")
            },
            1e3), !1)
        },
        e.lotterySync = function(e) {
            e = e || t.loop;
            var i = this;
            i._lotteryPullAjaxObj = $.post(t.url("lottery/sync"),
            function(r) {
                var n = null,
                s = null;
                "ok" == r.info ? (i._lottery_deleted_not_synced_ids.length || i._lotteryed_not_synced_ids.length || (i._lotteryed_ids = r.ids), i._pre_lottery_ids = r.pre_ids, i._pre_lottery_list = r.pre_list, n = !0, i.lotteryInitUser(), t.pub("user.lotterySynced", i)) : s = r.info,
                e(s, n)
            },
            "json").error(function(i, r) {
                i.readyState < 2 && "error" == r && t.pub("network.disconnected", i),
                e("user.lotterySync: ajax-error")
            })
        },
        e.lotteryRandom = function() {
            var e = this._lottery_ids.length - 1;
            if (0 > e) return ! 1;
            var i, r, n = this._lotteryed_ids.length;
            if (this._pre_lottery_list && this._pre_lottery_list.length) for (var s = 0; s < this._pre_lottery_list.length; s++) if (r = this._pre_lottery_list[s], (r.rank == n + 1 || 0 == parseInt(r.rank)) && -1 == t.inArray(r.user_id, this._lotteryed_ids)) {
                i = parseInt(r.user_id);
                break
            }
            if (!i) {
                var o = 0;
                for (i = this._lottery_ids[t.rand(0, e)]; ! ( - 1 == t.inArray(i, this._pre_lottery_ids) && -1 == t.inArray(i, this._lottery_deleted_not_synced_ids) || (o++, i = this._lottery_ids[t.rand(0, e)], o > 100)););
            }
            var l = this.info(i);
            return l || t.throwErr("user.lotteryRandom getElemByPointer failed uid=", i),
            l
        },
        e.lotterySave = function(e, i) {
            if (i = i || t.loop, !e || -1 == t.inArray(e, this._lottery_ids)) return i("没有在大屏幕中找到此用户"),
            void 0;
            if (t.inArray(e, this._lotteryed_ids) > -1) return i("保存失败，此用户已经中奖"),
            void 0;
            var r = this,
            n = function() {
                t.uniqueInsert(e, r._lotteryed_ids),
                t.deleteByElem(e, r._lottery_ids),
                i(null, !0)
            };
            return t.getConf("isDemo") ? (n(), void 0) : (t.uniqueInsert(e, r._lotteryed_not_synced_ids), $.ajax({
                type: "POST",
                url: t.url("lottery/lottery_save"),
                data: {
                    user: e
                },
                dataType: "json",
                timeout: 1e4,
                success: function(i) {
                    "ok" == i.info && t.deleteByElem(e, r._lotteryed_not_synced_ids)
                },
                error: function(e, i) {
                    e.readyState < 2 && "error" == i && t.pub("network.disconnected", e)
                }
            }), setTimeout(function() {
                n()
            },
            10), void 0)
        },
        e.lotteryDelete = function(e, i) {
            var r = this,
            n = function() {
                t.deleteByElem(e, r._lotteryed_ids),
                t.deleteByElem(e, r._lotteryed_not_synced_ids),
                t.uniqueInsert(e, r._lottery_ids),
                i(null, !0)
            };
            return t.getConf("isDemo") ? (n(), void 0) : (t.uniqueInsert(e, r._lottery_deleted_not_synced_ids), $.post(t.url("lottery/del_win_user"), {
                id: e
            },
            function(i) {
                "ok" == i.info && t.deleteByElem(e, r._lottery_deleted_not_synced_ids),
                n()
            },
            "json").error(function(e, i) {
                e.readyState < 2 && "error" == i && t.pub("network.disconnected", e)
            }), setTimeout(function() {
                n()
            },
            10), void 0)
        },
        e.lotteryReset = function(e) {
            e = e || t.loop;
            var i = this,
            r = function() {
                i._lotteryed_ids = [],
                i._lotteryed_not_synced_ids = [],
                i.lotteryInitUser(),
                e(null, !0)
            };
            return t.getConf("isDemo") ? (r(), void 0) : ($.post(t.url("lottery/lottery_reset"),
            function(e) {
                if ("ok" != e.info) for (var n = 0; n < i._lotteryed_ids.length; n++) t.uniqueInsert(i._lotteryed_ids[n], i._lottery_deleted_not_synced_ids);
                r()
            },
            "json").error(function(e, n) {
                for (var s = 0; s < i._lotteryed_ids.length; s++) t.uniqueInsert(i._lotteryed_ids[s], i._lottery_deleted_not_synced_ids);
                r(),
                e.readyState < 2 && "error" == n && t.pub("network.disconnected", e)
            }), void 0)
        },
        e.lotteryPollNotSynced = function() {
            var e = this;
            clearInterval(this._lotteryPullNotSyncTimer),
            this._lotteryPullNotSyncTimer = setInterval(function() {
                if (e._lotteryed_not_synced_ids.length || e._lottery_deleted_not_synced_ids.length) {
                    var i = e._lottery_deleted_not_synced_ids.concat(),
                    r = e._lotteryed_not_synced_ids.concat();
                    $.post(t.url("lottery/lottery_not_synced"), {
                        deleted: i.join(","),
                        lotteryed: r.join(",")
                    },
                    function(n) {
                        if ("ok" == n.info) {
                            for (var s = 0; s < i.length; s++) t.deleteByElem(i[s], e._lottery_deleted_not_synced_ids);
                            for (var s = 0; s < r.length; s++) t.deleteByElem(r[s], e._lotteryed_not_synced_ids)
                        } else t.DEBUG && t.log("user.lotteryPollNotSynced failed:", n)
                    },
                    "json").error(function(e, i) {
                        t.DEBUG && t.log("user.lotteryPollNotSynced failed: ajax-error"),
                        e.readyState < 2 && "error" == i && t.pub("network.disconnected", e)
                    })
                }
            },
            7e3)
        },
        e.lotteryShareToDom = function() {
            if (!window.JSON) return t.DEBUG && t.log("user.lotteryShareToDom failed: window.JSON is undefined"),
            void 0;
            clearInterval(this._lotteryShareToDomTimer);
            var e = this;
            this._lotteryShareToDomTimer = setInterval(function() {
                for (var i, r = [], n = 0; n < e._lotteryed_ids.length; n++) {
                    var s = e.info(e._lotteryed_ids[n]);
                    r.push(s)
                }
                var i = JSON.stringify({
                    data: r,
                    companyId: t.getConf("domain")
                });
                $("#lotteryDataJsonBox").length || $("body").append('<div id="lotteryDataJsonBox" style="display:none;"></div>'),
                $("#lotteryDataJsonBox").text(i)
            },
            2e3)
        },
        e._ddpPullTimer = null,
        e._ddpPullAjaxObj = null,
        e.ddpInitUser = function() {
            var e = t.parseVisibleTime("ddp");
            this._ddp_ids = {
                _m_ids: [],
                _f_ids: []
            };
            var i;
            for (i = 0; i < this._m_ids.length; i++) this.isInTimeArr(this._m_ids[i], e) && -1 == this.inDdp(this._m_ids[i]) && t.uniqueInsert(this._m_ids[i], this._ddp_ids._m_ids);
            for (i = 0; i < this._f_ids.length; i++) this.isInTimeArr(this._f_ids[i], e) && -1 == this.inDdp(this._f_ids[i]) && t.uniqueInsert(this._f_ids[i], this._ddp_ids._f_ids);
            return ! 0
        },
        e.ddpPullStop = function() {
            return clearTimeout(this._ddpPullTimer),
            this._ddpPullAjaxObj && (this._ddpPullAjaxObj.abort(), this._ddpPullAjaxObj = null),
            this
        },
        e.ddpPull = function() {
            var e = this;
            if (this.ddpPullStop(), !this.checkAuth("ddpPlug")) return this._ddpPullTimer = setTimeout(function() {
                e.ddpInitUser(),
                t.pub("user.ddpSynced")
            },
            1e3),
            void 0;
            if (t.getConf("isDemo")) return this._ddpPullTimer = setTimeout(function() {
                e.ddpInitUser(),
                t.pub("user.ddpSynced")
            },
            1e3),
            !1;
            var e = this;
            e.ddpSync(function() {
                "ddp" == t.getState() && (e._ddpPullTimer = setTimeout(function() {
                    e.ddpPull()
                },
                1e3 * t.rand(5, 9)))
            })
        },
        e.ddpSync = function(e) {
            e = e || t.loop;
            var i = this;
            i._ddpPullAjaxObj = $.post(t.url("ddp/sync"),
            function(r) {
                var n = null,
                s = null;
                "ok" == r.info ? (i._ddped_ids = r.ids, n = !0, i.ddpInitUser(), t.pub("user.ddpSynced", i)) : s = r.info,
                e(s, n)
            },
            "json").error(function(i, r) {
                i.readyState < 2 && "error" == r && t.pub("network.disconnected", i),
                e("user.ddpSync: ajax-error")
            })
        },
        e.ddpRandom = function(e) {
            if (!this._ddp_ids._m_ids.length || !this._ddp_ids._f_ids.length) return ! 1;
            if ("m" == e) {
                if (!this._ddp_ids._m_ids.length) return ! 1;
                var i = this._ddp_ids._m_ids[t.rand(0, this._ddp_ids._m_ids.length - 1)];
                return this.info(i)
            }
            if ("f" == e) {
                if (!this._ddp_ids._f_ids.length) return ! 1;
                var r = this._ddp_ids._f_ids[t.rand(0, this._ddp_ids._f_ids.length - 1)];
                return this.info(r)
            }
            if ("all" == e) {
                var n = this.ddpRandom("m");
                if (!n) return ! 1;
                var s = this.ddpRandom("f");
                return s ? {
                    user: n,
                    to_user: s
                }: !1
            }
            return ! 1
        },
        e.ddpSave = function(e, i, r) {
            if (r = r || t.loop, !e || !i) return r("ddpSave: id or to_id is not exists"),
            void 0;
            var n = this.ddpInfo(e) || this.ddpInfo(i);
            if (n && n.user_id > 0 && n.to_user_id > 0) return r("ddpSave: id or to_id is in ddp list"),
            void 0;
            var s = this.info(e),
            o = this.info(i),
            l = {
                id: 0,
                user_id: e,
                name: s.name,
                avatar: s.avatar,
                to_user_id: i,
                to_name: o.name,
                to_avatar: o.avatar
            },
            a = this,
            d = function(n) {
                var s = a.ddpInfo(e) || a.ddpInfo(i);
                s ? (s.user_id = l.user_id, s.name = l.name, s.avatar = l.avatar, s.to_user_id = l.to_user_id, s.to_name = l.to_name, s.to_avatar = l.to_avatar) : (l.id = n, a._ddped_ids.push(l)),
                t.deleteByElem(l.user_id, a._ddp_ids._m_ids),
                t.deleteByElem(l.to_user_id, a._ddp_ids._f_ids),
                r(null, s || l)
            };
            return t.getConf("isDemo") ? (d(t.cid()), void 0) : ($.post(t.url("ddp/save"), {
                user: e,
                to_user: i
            },
            function(n) {
                return n && "object" == typeof n && n.info ? ("ok" == n.info ? d(n.matched_info.id) : r(n.info), void 0) : (t.counter("user_ddpsave") < 2 ? a.ddpSave(e, i, r) : (t.counter("user_ddpsave", "reset"), r("ddpsave: the wxscreen server not response")), void 0)
            },
            "json").error(function(e, i) {
                e.readyState < 2 && "error" == i && t.pub("network.disconnected", e),
                r("user.ddpSave: ajax-error")
            }), void 0)
        },
        e.ddpDelete = function(e, i, r) {
            if (isNaN(e) || isNaN(i)) return r("ddpDelete: arguments is empty");
            var n = this.ddpInfo(e) || this.ddpInfo(i);
            if (!n) return r("ddpInfo not found");
            var s = e ? e: i,
            o = this.inDdp(s),
            l = this,
            a = function() {
                e > 0 && i > 0 ? (l._ddped_ids.splice(o, 1), t.uniqueInsert(e, l._ddp_ids._m_ids), t.uniqueInsert(i, l._ddp_ids._f_ids), n.user_id = 0, n.to_user_id = 0) : e ? (n.user_id = 0, t.uniqueInsert(e, l._ddp_ids._m_ids)) : i && (n.to_user_id = 0, t.uniqueInsert(i, l._ddp_ids._f_ids)),
                r(null, n)
            };
            return t.getConf("isDemo") ? (a(), void 0) : ($.post(t.url("ddp/del_user"), {
                id: e,
                to_id: i
            },
            function(n) {
                return n && "object" == typeof n && n.info ? ("ok" == n.info ? a() : r(n.info), void 0) : (t.counter("user_ddpdelete") < 2 ? l.ddpDelete(e, i, r) : (t.counter("user_ddpdelete", "reset"), r("the wxscreen server not response")), void 0)
            },
            "json").error(function(e, i) {
                e.readyState < 2 && "error" == i && t.pub("network.disconnected", e),
                r("user.ddpDelete: ajax-error")
            }), void 0)
        },
        e.ddpReset = function(e) {
            e = e || t.loop;
            var i = this,
            r = function() {
                i._ddped_ids = [],
                i.ddpInitUser(),
                e(null, !0)
            };
            return t.getConf("isDemo") ? (r(), void 0) : ($.post(t.url("ddp/reset"),
            function(n) {
                return n && "object" == typeof n && n.info ? ("ok" == n.info ? r() : e(n.info), void 0) : (t.counter("user_ddpreset") < 2 ? i.ddpReset(e) : (t.counter("user_ddpreset", "reset"), e("ddpreset: the wxscreen server not response")), void 0)
            },
            "json").error(function(i, r) {
                i.readyState < 2 && "error" == r && t.pub("network.disconnected", i),
                e("ddpReset: ajax-error")
            }), void 0)
        },
        e.inDdp = function(t) {
            for (var e, i = -1,
            r = 0; r < this._ddped_ids.length; r++) if (e = this._ddped_ids[r], e.user_id == t || e.to_user_id == t) {
                i = r;
                break
            }
            return i
        },
        e.ddpInfo = function(t) {
            if (!t) return ! 1;
            var e = this.inDdp(t);
            return 0 > e ? !1 : this._ddped_ids[e]
        },
        e.checkAuth = function(e) {
            return e && !t.getConf(e) ? !1 : t.isAdmin() || t.getConf("isDemo") ? !0 : !1
        }
    }
} (wxscreen);