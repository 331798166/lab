!
function(t) {
    function e() {
        n(),
        r()
    }
    function r() {
        t.sub("user.synced", function() {
            t.user._isReady && g(t.user._lottery_ids.length)
        }),
        t.sub("user.lotterySynced", function() {
            t.user._isReady && (g(t.user._lottery_ids.length), y())
        }),
        t.subOnce("user.all_ready", function() {
            $(".startLotteryBtn").children("span").text("开始抽奖"),
            t.btnLoading($(".resetLotteryBtn"), "hide"),
            g(t.user._lottery_ids.length),
            y(),
            $(".startLotteryBtn").click(function() {
                b === !1 ? a() : o()
            }),
            $(".resetLotteryBtn").click(function() {
                var e = $(this);
                return "yes" == e.attr("data-disabled") ? (t.showMsg("请稍等，大屏幕正在重置抽奖~"), !1) : (e.attr("data-disabled", "yes"), t.btnLoading(e, "show"), t.user.lotteryReset(function(r) {
                    return t.btnLoading(e, "hide"),
                    e.attr("data-disabled", "no"),
                    r ? t.showMsg(r) : (y(), g(t.user._lottery_ids.length), d(), void 0)
                }), void 0)
            })
        }),
        t.sub("key.enter.down", function() {
            "lottery" == t.getState() && $(".startLotteryBtn").trigger("click")
        })
    }
    function n() {
        $(".btnLottery").click(function() {
            return t.getConf("lotteryPlug") ? (s(), void 0) : (alert("您还没有开通抽奖功能，详情咨询客服"), void 0)
        }),
        t.sub("key.67.down",
        function() {
            $(".btnLottery").trigger("click")
        })
    }
    function i() {
        $(".winUserList li").unbind(),
        $(".delWinUser").unbind(),
        $(".winUserList li").hover(function() {
            $(this).children(".delWinUser").toggle()
        }),
        $(".delWinUser").click(function() {
            var e = $(this).attr("data-id");
            return e ? ($(this), t.user.lotteryDelete(e,
            function(r) {
                return r ? t.showMsg(json.info) : ($('.winUserList li[data-id="' + e + '"]').fadeOut(function() {
                    $('.winUserList li[data-id="' + e + '"]').remove(),
                    y(),
                    g(t.user._lottery_ids.length)
                }), void 0)
            }), void 0) : !1
        })
    }
    function s() {
        $(".lotteryLayer:visible").length ? t.setState("message") : t.setState("lottery")
    }
    function a() {
        return t.user._lottery_ids.length <= 0 ? (t.showMsg("亲，参与的人已全部中奖啦~"), !1) : "yes" == $(".startLotteryBtn").attr("data-disabled") ? (t.showMsg("正在保存上次中奖数据，请稍等~"), !1) : ($(".startLotteryBtn").children("span").text("停止"), _ = setInterval(function() {
            u(c())
        },
        50), b = !0, void 0)
    }
    function o() {
        clearInterval(_),
        _ = null,
        u(w),
        l(),
        $(".startLotteryBtn").children("span").text("开始抽奖"),
        b = !1
    }
    function l() {
        var e = {
            id: w.id,
            avatar: w.avatar,
            name: w.name
        },
        r = $(".startLotteryBtn");
        r.attr("data-disabled", "yes"),
        t.btnLoading(r, "show"),
        t.user.lotterySave(e.id,
        function(n) {
            return t.btnLoading(r, "hide"),
            r.attr("data-disabled", "no"),
            y(e),
            g(t.user._lottery_ids.length),
            n ? t.showMsg(n) : void 0
        })
    }
    function d() {
        $(".lotteryLayer .lotteryImg").attr("src", $(".lotteryLayer .lotteryImg").data("default_src")),
        $(".lotteryLayer .lotteryName").text("... ..."),
        w = null
    }
    function u(t) {
        $(".lotteryLayer .lotteryImg").attr("src", t.avatar),
        $(".lotteryLayer .lotteryName").html(t.name),
        m || (w = t)
    }
    function c() {
        var e = t.user.lotteryRandom();
        return w && e.id == w.id ? (e = t.user.random(), m = !0) : m = !1,
        e
    }
    function y(e) {
        var r = "";
        if (e) r = f(e),
        $(".winUserList").prepend(r),
        $(".winUserList").parent().scrollTop(0);
        else {
            for (var n = !1,
            s = t.user._lotteryed_ids.length - 1; s >= 0; s--) {
                var a = t.user.info(t.user._lotteryed_ids[s]);
                a || t.DEBUG && t.log("in lottery _renderWinUser foreach user get false."),
                $('.winUserList li[data-id="' + a.id + '"]').length || (n = !0),
                r += f(a)
            } (n || !t.user._lotteryed_ids.length) && $(".winUserList").html(r)
        }
        L(t.user._lotteryed_ids.length),
        i(),
        h()
    }
    function f(t) {
        var e = '      <li class="clearfix" data-id="' + t.id + '">        <p class="head-part left">          <span class="num-p winUserRankNum"></span>          <a href="javascript:;"><img width="50" height="50" src="' + t.avatar + '" alt=""></a>        </p>        <a href="javascript:;" class="nick-name left winUserName">' + t.name + '</a>        <a href="javascript:void(0);" class="del delWinUser" data-id="' + t.id + '">×</a>      </li>';
        return e
    }
    function h() {
        var t = $(".winUserList li"),
        e = t.length;
        $.each(t,
        function(t) {
            $(this).find(".winUserRankNum").text(e - t)
        })
    }
    function g(t) {
        $(".lotteryLayer .lotteryUserNum").text(t)
    }
    function L(t) {
        $(".lotteryLayer .winUserNum").text(t)
    }
    if (!t.lottery) {
        var v = t.lottery = {};
        v.off = function() {
            t.user._isReady && (t.user.pullStop(), t.user.lotteryPullStop()),
            $(".lotteryLayer").fadeOut("fast")
        },
        v.on = function() {
            t.user._isReady && t.user.pull(),
            t.user.lotteryPull(),
            $(".lotteryLayer").fadeIn("fast")
        };
        var _ = null,
        w = null,
        m = !1,
        b = !1;
        $(function() {
            e()
        })
    }
} (wxscreen);