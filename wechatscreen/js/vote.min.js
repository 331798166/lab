!function(t){if(t.vote)return!1;var o=t.vote={};o._voteInfo=null,o._barMap=["","progress-bar-first","progress-bar-second","progress-bar-third"],o._timer=null,o._ajaxObj=null,o._eventInited=!1,o.init=function(o){return this._voteInfo=o,this._voteInfo?($(".voteClosedBox").hide(),$(".voteOpendBox").show(),this.render(),this.center()):($(".voteClosedBox").show(),$(".voteOpendBox").hide(),t.DEBUG&&t.log("vote.init failed: voteInfo is empty")),this._eventInited||this.initEvent(),this},o.render=function(){return $(".voteTitle").html(this._voteInfo.title),$(".voteIntro").html(this._voteInfo.intro),$(".voteJoinNum").text(this._voteInfo.join_count),this.renderOption(),this},o.renderOption=function(){var o=$(".voteOptionBox"),e=this,n=this._voteInfo.option_list.length,i=[];$.each(this._voteInfo.option_list,function(t){this.viewOrder=t+1,i.push(e.renderOptionOne(this))});var r=0,s=0,l=[],h=0,a=0;if($(".optionRow ul:eq(0)").html(""),$(".optionRow ul:eq(1)").html(""),$(".optionRow ul:eq(2)").html(""),5>=n?(s=1,a=5):10>=n?(s=2,a=5):15>=n?(s=3,a=5):(s=3,a=6),s){r=0;for(var v=1;v<=i.length&&(l[r]||(l[r]=0),l[r]++,l[r]>=a&&r++,!(r>=s));v++);}return t.DEBUG&&t.log("vote.render boxNums:",l),h=0,$.each(l,function(t,o){return o?($(".optionRow ul:eq("+t+")").html(i.slice(h,h+o).join("")),h+=o,void 0):!1}),this.resetViewOrder(),o.removeClass("one-row two-row three-row three-row-five").addClass(this.getOptionClass()),this},o.resetViewOrder=function(){var t=1;$.each($(".optionRow ul:eq(0)").children("li"),function(){$(this).find(".voteViewOrder").text(t++)}),$.each($(".optionRow ul:eq(1)").children("li"),function(){$(this).find(".voteViewOrder").text(t++)}),$.each($(".optionRow ul:eq(2)").children("li"),function(){$(this).find(".voteViewOrder").text(t++)})},o.renderOptionOne=function(t){var o=this._barMap[parseInt(t.rank)]||"",e=parseInt(this._voteInfo.vote_count&&t.option_count)?(100*(t.option_count/this._voteInfo.vote_count)).toFixed(1):0,n='            <li class="clearfix" data-id="'+t.id+'">              <span class="votenum voteViewOrder">'+t.viewOrder+'</span>              <div class="example">                <p class="vote-topic">'+t.option_content+'</p>                <div class="progress">                  <div class="progress-bar '+o+'" style="width:'+e+'%;">                    <p class="words-tips"><span class="sr-only">'+e+"%</span><span> <em>"+t.option_count+"</em>票</span></p>                  </div>                </div>              </div>            </li>";return n},o.getOptionClass=function(){var t=this._voteInfo.option_list.length;return 5>=t?"one-row":10>=t?"two-row":15>=t?"three-row-five":"three-row"},o.sync=function(){if(this._ajaxObj){try{this._ajaxObj.abort()}catch(o){t.DEBUG&&t.log("vote.sync: _ajaxObj.abort error")}this._ajaxObj=null}var e=this;this._ajaxObj=$.post(t.url("vote/current"),function(o){"ok"!=o.info?t.showMsg(o.info):e.init(o.vote_info)},"json").error(function(o,e){t.DEBUG&&t.log("vote.sync failed: ajax-error",e)})},o.poll=function(){this.pollStop();var t=this;this._timer=setInterval(function(){t.sync()},5e3)},o.pollStop=function(){return clearInterval(this._timer),this._timer=null,this},o.on=function(){this.sync(),$("#vote_layer").fadeIn(),this.poll();try{t.ddp&&t.ddp.off(),t.lottery&&t.lottery.off()}catch(o){t.DEBUG&&t.log("vote.on off other failed",o)}},o.off=function(){$("#vote_layer").hide(),this.pollStop()},o.show=function(){t.setState("vote")},o.hide=function(){t.setState("message")},o.initEvent=function(){var o=this;$(".btnVote").click(function(){return t.getConf("votePlug")?($("#vote_layer:visible").length?o.hide():o.show(),void 0):(t.showMsg("您还没有开通投票功能，详情咨询客服"),void 0)}),$(".voteCloseBtn").click(function(){o.hide()}),t.sub("key.84.down",function(){$(".btnVote").trigger("click")}),this._eventInited=!0},o.center=function(){var o,e=$(".optionRow ul:eq(0)").find("li"),n=t._height(e.eq(0)),i=n*e.length;o=this._voteInfo.option_list.length<=10?5*n:6*n;var r=0;return o>i&&(r=(370-i)/2),$(".voteOptionBox").css({"margin-top":r+"px"}),this}}(wxscreen);